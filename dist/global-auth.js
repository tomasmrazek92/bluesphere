"use strict";(()=>{(function(){let Q={API_BASE:"https://bluesphere.dev.longtermhealth.de",DEBUG:!0},E={TOKEN_KEY:"auth_token",REFRESH_KEY:"refresh_token",USER_KEY:"user_data"},l={log:(...e)=>Q.DEBUG&&console.log("[AUTH]",...e),error:(...e)=>console.error("[AUTH]",...e)},r=(e,t=document)=>t.querySelector(e),v=(e,t=document)=>[...t.querySelectorAll(e)],w={set:function(e,t,i=60){let s={value:t,expiry:new Date().getTime()+i*60*1e3};try{sessionStorage.setItem(e,JSON.stringify(s))}catch(c){l.error("Storage error:",c)}},get:function(e){try{let t=sessionStorage.getItem(e);if(!t)return null;let i=JSON.parse(t);return new Date().getTime()>i.expiry?(sessionStorage.removeItem(e),null):i.value}catch{return null}},remove:function(e){sessionStorage.removeItem(e)}};async function Y(e,t={}){let i=Q.API_BASE+e,s=w.get(E.TOKEN_KEY),c={"Content-Type":"application/json",...t.headers};s&&(c.Authorization=`Bearer ${s}`),l.log("API Call:",e,t.method||"GET");try{let u=await fetch(i,{...t,headers:c});return l.log("API Response:",u.status),u}catch(u){throw l.error("API error:",u),u}}let O={firstName:"",lastName:"",email:"",password:""},X={male:"MALE",female:"FEMALE",diverse:"NON_BINARY","non-binary":"NON_BINARY",other:"OTHER","no-share":"NO_SHARE",unknown:"UNKNOWN",MALE:"MALE",FEMALE:"FEMALE",NON_BINARY:"NON_BINARY",OTHER:"OTHER",NO_SHARE:"NO_SHARE",UNKNOWN:"UNKNOWN"};async function ee(e){let{firstName:t,lastName:i,email:s,password:c,dateOfBirth:u,gender:m}=e;l.log("Registering user:",s);let y=X[m]||X[m.toLowerCase()]||"UNKNOWN",f={firstName:t.trim(),lastName:i.trim(),email:s.toLowerCase().trim(),password:c,dateOfBirth:u,gender:y,role:"PATIENT"},p=await Y("/user/registration",{method:"POST",body:JSON.stringify(f)});if(!p.ok){let _=await p.json().catch(()=>({}));throw new Error(_.statusMessage||_.message||"Registrierung fehlgeschlagen")}let L=await p.json();return l.log("Registration successful:",L),w.set(E.USER_KEY,{name:`${t} ${i}`,email:s,id:L.userId||L.id}),L}async function te(e,t){l.log("Logging in user:",e);let i=await Y("/user/login",{method:"POST",body:JSON.stringify({email:e.toLowerCase().trim(),password:t})});if(!i.ok){let p=await i.json().catch(()=>({}));throw new Error(p.statusMessage||p.message||"Anmeldung fehlgeschlagen")}let s=await i.json();l.log("Login response:",s);let c=s.result||s,u=c.user||c,m=c.token||c.accessToken||s.token||s.accessToken,y=c.refreshToken||s.refreshToken;m?(w.set(E.TOKEN_KEY,m),l.log("Token stored")):l.log("Warning: No token in login response"),y&&w.set(E.REFRESH_KEY,y,60*24*7);let f={name:u.firstName?`${u.firstName} ${u.lastName}`:u.name,email:u.email||e,id:u.id};return w.set(E.USER_KEY,f),localStorage.setItem("userName",f.name),localStorage.setItem("userEmail",f.email),localStorage.setItem("userId",String(f.id)),l.log("Login successful"),window.dispatchEvent(new CustomEvent("auth-changed",{detail:{authenticated:!0}})),u}async function ne(e){l.log("Verifying email with code:",e);let t=await Y("/user/confirmation",{method:"POST",body:JSON.stringify({code:e.trim()})});if(!t.ok&&t.status!==201){let s=await t.json().catch(()=>({}));throw new Error(s.statusMessage||s.message||"Verifizierung fehlgeschlagen")}let i=await t.json();return l.log("Verification successful:",i),(i.token||i.accessToken)&&w.set(E.TOKEN_KEY,i.token||i.accessToken),window.dispatchEvent(new CustomEvent("auth-changed",{detail:{authenticated:!0}})),i}async function ie(){l.log("Resending verification code");let e=w.get(E.USER_KEY);if(!(e!=null&&e.email))throw new Error("Keine E-Mail-Adresse gefunden");let t=await Y("/user/verification-code-resend",{method:"POST",body:JSON.stringify({email:e.email})});if(!t.ok){let i=await t.json().catch(()=>({}));throw new Error(i.statusMessage||i.message||"Code konnte nicht gesendet werden")}return!0}function V(){let e=w.get(E.TOKEN_KEY),t=w.get(E.USER_KEY);return!!(e||t)}function I(){return w.get(E.USER_KEY)}function oe(){w.remove(E.TOKEN_KEY),w.remove(E.REFRESH_KEY),w.remove(E.USER_KEY),localStorage.removeItem("userName"),localStorage.removeItem("userEmail"),localStorage.removeItem("userId"),window.dispatchEvent(new CustomEvent("auth-changed",{detail:{authenticated:!1}})),l.log("User logged out")}let xe=0,se="login";function ae(){return r('[data-modal-name="register"]')}function R(){let e=ae();return e?v('[data-register="form-step"]',e):v('[data-register="form-step"]')}function M(e){R().forEach((i,s)=>{i.style.display=s===e?"block":"none"}),xe=e,l.log("Showing step:",e)}function re(){let e=R();for(let t=0;t<e.length;t++)if(e[t].getAttribute("data-register-type")==="register"){M(t),se="register";return}}function le(){let e=R();for(let t=0;t<e.length;t++)if((e[t].getAttribute("data-registe-type")||e[t].getAttribute("data-register-type"))==="sign-in"){M(t),se="login";return}}function Ne(){let e=R();for(let t=0;t<e.length;t++)if(e[t].getAttribute("data-register-type")==="personal-info"){M(t);return}}function Ae(){let e=R();for(let t=0;t<e.length;t++)if(e[t].getAttribute("data-register-type")==="code"){M(t);return}}function Z(){M(0)}function de(){if(l.log("Opening register modal"),typeof window.openModal=="function")window.openModal("register"),setTimeout(()=>{Z()},100);else{let e=r('[data-modal-target="register"]'),t=r('[data-modal-name="register"]'),i=r("[data-modal-group-status]");e&&e.setAttribute("data-modal-status","active"),t&&t.setAttribute("data-modal-status","active"),i&&i.setAttribute("data-modal-group-status","active"),setTimeout(()=>{Z()},100)}}function J(){if(typeof window.closeAllModals=="function")window.closeAllModals();else{let e=r('[data-modal-target="register"]'),t=r('[data-modal-name="register"]'),i=r("[data-modal-group-status]");e&&e.setAttribute("data-modal-status","not-active"),t&&t.setAttribute("data-modal-status","not-active"),i&&i.setAttribute("data-modal-group-status","not-active")}}function b(e,t){let i=e.querySelector(".auth-error-message");if(!i){i=document.createElement("div"),i.className="auth-error-message",i.style.cssText="color: #dc3545; padding: 10px; margin: 10px 0; background: #f8d7da; border-radius: 4px; font-size: 14px;";let s=e.querySelector(".form_field-wrap");s?s.parentNode.insertBefore(i,s):e.prepend(i)}i.textContent=t,i.style.display="block",setTimeout(()=>{i.style.display="none"},5e3)}function F(){v(".auth-error-message").forEach(e=>e.style.display="none"),v(".form_validation.show").forEach(e=>e.classList.remove("show")),v(".form_field.error").forEach(e=>e.classList.remove("error"))}function C(e,t){t?(e.setAttribute("data-loading","true"),e.style.opacity="0.7",e.style.pointerEvents="none"):(e.removeAttribute("data-loading"),e.style.opacity="1",e.style.pointerEvents="auto")}function S(e,t="info"){var c;let i=((c=document.querySelector(".navbar"))==null?void 0:c.getBoundingClientRect().bottom)||80,s=document.createElement("div");s.style.cssText=`position:fixed;top:${i+8}px;right:20px;padding:16px 24px;background:${t==="success"?"#00a86b":t==="error"?"#dc3545":"#333"};color:white;border-radius:8px;z-index:10001;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.15);transition:opacity 0.3s;`,s.textContent=e,document.body.appendChild(s),setTimeout(()=>{s.style.opacity="0",setTimeout(()=>s.remove(),300)},3e3)}function Be(){l.log("Setting up auth handlers");let e=ae();if(!e){l.log("Register modal not found");return}let t=r('[data-register="form-wrap"]',e);if(!t){l.log("Auth form not found in register modal");return}l.log("Found form in register modal"),t.addEventListener("submit",n=>{n.preventDefault()});let i=r('[data-register="email-signin"]',e);i&&i.addEventListener("click",n=>{n.preventDefault(),l.log("Email signin clicked"),le()}),v('[data-register="register-link"]',e).forEach(n=>{n.addEventListener("click",o=>{o.preventDefault(),l.log("Register link clicked"),re()})}),v('[data-register="login-link"]',e).forEach(n=>{n.addEventListener("click",o=>{o.preventDefault(),l.log("Login link clicked"),le()})}),v('[data-register="btn-back"]',e).forEach(n=>{n.addEventListener("click",o=>{o.preventDefault(),l.log("Back button clicked");let a=n.closest('[data-register="form-step"]');a&&a.getAttribute("data-register-type")==="personal-info"?re():Z()})});let m=r('[data-register="btn-next"]',e);function y(){var n,o,a,d,g;return{firstName:((n=r("#first_name",e)||r('input[name="first_name"]',e))==null?void 0:n.value)||"",lastName:((o=r("#last_name",e)||r('input[name="last_name"]',e))==null?void 0:o.value)||"",email:((a=r("#email-sign-in",e)||r('input[name="email-sign-in"]',e))==null?void 0:a.value)||"",password:((d=r("#password-signin",e)||r('input[name="password-signin"]',e))==null?void 0:d.value)||"",passwordConfirm:((g=r("#password-signin-again",e)||r('input[name="password-signin-again"]',e))==null?void 0:g.value)||""}}function f(n,o){let a=n.closest(".form_field-wrap");if(!a)return;let d=a.querySelector(".form_field");d&&d.classList.add("error");let g=a.querySelector(".form_validation");g&&(g.textContent=o,g.classList.add("show"))}function p(n){let o=n.closest(".form_field-wrap");if(!o)return;let a=o.querySelector(".form_field");a&&a.classList.remove("error");let d=o.querySelector(".form_validation");d&&d.classList.remove("show")}function L(n){if(!n)return;let o=n.value;o&&(o.length<8||!/[A-Z]/.test(o)||!/[a-z]/.test(o)||!/[0-9]/.test(o)||!/[^A-Za-z0-9]/.test(o)?f(n,"Mindestens 8 Zeichen, Gro\xDF-/Kleinbuchstabe, Zahl und Sonderzeichen"):p(n))}function _(n,o){if(!n||!o)return;let a=n.value;a&&(a!==o.value?f(n,"Passw\xF6rter stimmen nicht \xFCberein"):p(n))}function Re(){let n=y();return!(!n.firstName||!n.lastName||!n.email||!n.email.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||!n.password||n.password.length<8||!/[A-Z]/.test(n.password)||!/[a-z]/.test(n.password)||!/[0-9]/.test(n.password)||!/[^A-Za-z0-9]/.test(n.password)||n.password!==n.passwordConfirm)}function me(){if(!m)return;let n=Re();m.style.opacity=n?"":"0.5",m.style.pointerEvents=n?"auto":"none"}let x=e.querySelector('[data-register-type="register"]');if(x){x.addEventListener("input",me),me();let n=x.querySelector('#first_name, input[name="first_name"]'),o=x.querySelector('#last_name, input[name="last_name"]'),a=x.querySelector('#email-sign-in, input[name="email-sign-in"]'),d=x.querySelector('#password-signin, input[name="password-signin"]'),g=x.querySelector('#password-signin-again, input[name="password-signin-again"]');n&&n.addEventListener("input",()=>{n.value.trim()&&p(n)}),o&&o.addEventListener("input",()=>{o.value.trim()&&p(o)}),a&&a.addEventListener("input",()=>{a.value&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.value)&&p(a)}),d&&d.addEventListener("input",()=>{L(d),g&&g.value&&_(g,d)}),g&&g.addEventListener("input",()=>_(g,d)),n&&n.addEventListener("blur",()=>{n.value.trim()||f(n,"Bitte Vornamen eingeben")}),o&&o.addEventListener("blur",()=>{o.value.trim()||f(o,"Bitte Nachnamen eingeben")}),a&&a.addEventListener("blur",()=>{a.value?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a.value)||f(a,"Bitte g\xFCltige E-Mail eingeben"):f(a,"Bitte E-Mail eingeben")}),d&&d.addEventListener("blur",()=>L(d)),g&&g.addEventListener("blur",()=>{g.value?_(g,d):f(g,"Bitte Passwort best\xE4tigen")})}m&&m.addEventListener("click",n=>{var T,k,K,z,P,B,be,Se,ke,Le;n.preventDefault(),l.log("Next button clicked (register step 1)"),F();let o=((T=r("#first_name",e))==null?void 0:T.value)||((k=r('input[name="first_name"]',e))==null?void 0:k.value)||"",a=((K=r("#last_name",e))==null?void 0:K.value)||((z=r('input[name="last_name"]',e))==null?void 0:z.value)||"",d=((P=r("#email-sign-in",e))==null?void 0:P.value)||((B=r('input[name="email-sign-in"]',e))==null?void 0:B.value)||"",g=((be=r("#password-signin",e))==null?void 0:be.value)||((Se=r('input[name="password-signin"]',e))==null?void 0:Se.value)||"",D=((ke=r("#password-signin-again",e))==null?void 0:ke.value)||((Le=r('input[name="password-signin-again"]',e))==null?void 0:Le.value)||"";if(l.log("Form values:",{firstName:o,lastName:a,email:d,hasPassword:!!g}),!o||!a){b(t,"Bitte Vor- und Nachnamen eingeben");return}if(!d||!d.match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)){b(t,"Bitte eine g\xFCltige E-Mail-Adresse eingeben");return}if(!g||g.length<8||!/[A-Z]/.test(g)||!/[a-z]/.test(g)||!/[0-9]/.test(g)||!/[^A-Za-z0-9]/.test(g)){b(t,"Passwort: min. 8 Zeichen, 1 Gro\xDFbuchstabe, 1 Kleinbuchstabe, 1 Zahl und 1 Sonderzeichen");return}if(g!==D){b(t,"Passw\xF6rter stimmen nicht \xFCberein");return}O={firstName:o,lastName:a,email:d,password:g},Ne()});let N=r('[data-register="btn-send"]',e),h=e.querySelector('[data-register-type="personal-info"]');function W(){if(!h)return"";let n=r("select",h),o=(n==null?void 0:n.value)||"";if(!o&&n){let a=n.nextElementSibling;if(a&&a.classList.contains("nice-select")){let d=a.querySelector(".option.selected");d&&d.getAttribute("data-value")&&(o=d.getAttribute("data-value"))}}return o}function Me(){var a;return!(!h||!(((a=r("#dateOfBirth",h)||r('input[name="dateOfBirth"]',h)||r('input[data-toggle="datepicker"]',h))==null?void 0:a.value)||"")||!W()||v('input[type="checkbox"][required]',h).some(d=>!d.checked))}function $(){if(!N)return;let n=Me();N.style.opacity=n?"":"0.5",N.style.pointerEvents=n?"auto":"none"}if(h){h.addEventListener("input",$),h.addEventListener("change",$),h.addEventListener("click",d=>{d.target.closest(".nice-select .option")&&setTimeout($,50)}),$();let n=h.querySelector('#dateOfBirth, input[name="dateOfBirth"]'),o=h.querySelector("select"),a=[...h.querySelectorAll('input[type="checkbox"][required]')];n&&n.addEventListener("blur",()=>{n.value?p(n):f(n,"Bitte Geburtsdatum eingeben")}),n&&n.addEventListener("input",()=>{n.value&&p(n)}),o&&o.addEventListener("change",()=>{o.value?p(o):f(o,"Bitte Geschlecht ausw\xE4hlen")}),h.addEventListener("click",d=>{d.target.closest(".nice-select .option")&&o&&setTimeout(()=>{W()&&p(o)},100)}),a.forEach(d=>{d.addEventListener("change",()=>{d.checked?p(d):f(d,"Bitte akzeptieren")})})}N&&N.addEventListener("click",async n=>{var k,K,z,P;n.preventDefault(),l.log("Send button clicked (register step 2)"),F();let o=((k=r("#dateOfBirth",e))==null?void 0:k.value)||((K=r('input[name="dateOfBirth"]',e))==null?void 0:K.value)||((z=r('input[name="date-of-birth"]',e))==null?void 0:z.value)||((P=r('input[data-toggle="datepicker"]',e))==null?void 0:P.value)||"";if(!o){b(t,"Bitte Geburtsdatum eingeben");return}let a,d=o.match(/^(\d{1,2})\.(\d{1,2})\.(\d{4})$/);d?a=`${d[3]}-${d[2].padStart(2,"0")}-${d[1].padStart(2,"0")}`:a=new Date(o).toISOString().split("T")[0];let g=W();if(!g){b(t,"Bitte Geschlecht ausw\xE4hlen");return}if(v('input[type="checkbox"][required]',h||e).filter(B=>!B.checked).length>0){b(t,"Bitte stimme den Datenschutz- und Gesch\xE4ftsbedingungen zu");return}O.dateOfBirth=a,O.gender=g,l.log("Full registration data:",O),C(N,!0);try{await ee(O),S("Registrierung erfolgreich! Bitte Code eingeben.","success"),Ae()}catch(B){l.error("Registration error:",B),b(t,B.message)}finally{C(N,!1)}});let A=r('[data-register="btn-signin"]',e);function fe(){var a,d;let n=((a=r("#email-login",e)||r('input[name="email-login"]',e))==null?void 0:a.value)||"",o=((d=r("#password-login",e)||r('input[name="password-login"]',e))==null?void 0:d.value)||"";return!!(n&&o)}function pe(){A&&(A.style.opacity=fe()?"":"0.5",A.style.pointerEvents=fe()?"auto":"none")}let he=e.querySelector('[data-register-type="sign-in"]')||e.querySelector('[data-registe-type="sign-in"]');he&&(he.addEventListener("input",pe),pe()),A&&A.addEventListener("click",async n=>{var d,g,D,T;n.preventDefault(),l.log("Signin button clicked"),F();let o=((d=r("#email-login",e))==null?void 0:d.value)||((g=r('input[name="email-login"]',e))==null?void 0:g.value)||"",a=((D=r("#password-login",e))==null?void 0:D.value)||((T=r('input[name="password-login"]',e))==null?void 0:T.value)||"";if(l.log("Login attempt:",o),!o||!a){b(t,"Bitte E-Mail und Passwort eingeben");return}C(A,!0);try{await te(o,a),S("Anmeldung erfolgreich!","success"),J(),U(),window.location.pathname.includes("/deine-bestellung")||ce()}catch(k){l.error("Login error:",k),b(t,k.message)}finally{C(A,!1)}});let q=v('input[name^="code-"]',e);q.forEach((n,o)=>{n.addEventListener("input",a=>{a.target.value.length===1&&o<q.length-1&&q[o+1].focus()}),n.addEventListener("keydown",a=>{a.key==="Backspace"&&!a.target.value&&o>0&&q[o-1].focus()})});let j=r('[data-register="btn-code-confirm"]',e);j&&j.addEventListener("click",async n=>{n.preventDefault(),l.log("Code confirm clicked"),F();let o="";if(q.forEach(a=>{o+=a.value}),l.log("Code entered:",o),o.length!==6){b(t,"Bitte den vollst\xE4ndigen 6-stelligen Code eingeben");return}C(j,!0);try{await ne(o),S("E-Mail erfolgreich verifiziert!","success"),J(),U()}catch(a){l.error("Verification error:",a),b(t,a.message)}finally{C(j,!1)}});let ve=r('[data-register="code-resend"]',e);ve&&ve.addEventListener("click",async n=>{n.preventDefault(),l.log("Resend code clicked");try{await ie(),S("Code wurde erneut gesendet","success")}catch(o){l.error("Resend error:",o),S(o.message,"error")}});let ye=r('[data-register="password-forget"]',e);ye&&ye.addEventListener("click",n=>{n.preventDefault(),l.log("Password forget clicked"),S("Passwort-Reset wird noch implementiert","info")});let Ee=r('[data-register="google-signin"]',e);Ee&&Ee.addEventListener("click",n=>{n.preventDefault(),l.log("Google signin clicked"),S("Google-Anmeldung wird noch implementiert","info")});let we=r('[data-register="apple-signin"]',e);we&&we.addEventListener("click",n=>{n.preventDefault(),l.log("Apple signin clicked"),S("Apple-Anmeldung wird noch implementiert","info")}),l.log("Auth handlers setup complete")}function U(){let e=V(),t=I();l.log("Updating auth UI, authenticated:",e,t),v('[data-auth-show="logged-in"]').forEach(c=>{c.style.display=e?"":"none"});let i=window.location.pathname,s=i==="/"||i==="/en"||i==="/en/"||i.includes("/vision");v('[data-auth-show="logged-out"]').forEach(c=>{c.classList.contains("nav_user")?s?c.style.display="none":c.style.display="":c.style.display=e?"none":""}),t&&(v('[data-auth-user="name"]').forEach(c=>{c.textContent=t.name}),v('[data-auth-user="email"]').forEach(c=>{c.textContent=t.email}))}let Ce="https://calendly.com/j-erdweg-longtermhealth/biomarker-bluttest";function ce(){l.log("Opening Calendly modal");let e=I(),t=(e==null?void 0:e.name)||localStorage.getItem("userName")||"",i=(e==null?void 0:e.email)||localStorage.getItem("userEmail")||"",s=document.getElementById("calendly-modal-overlay");if(s){let y=document.getElementById("calendly-embed-container");y&&(y.innerHTML=""),s.style.display="flex",setTimeout(()=>{s.style.opacity="1"},10),ue(t,i);return}s=document.createElement("div"),s.id="calendly-modal-overlay",s.style.cssText="position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:10000;display:flex;align-items:center;justify-content:center;opacity:0;transition:opacity 0.3s;";let c=document.createElement("div");c.style.cssText="background:#fff;border-radius:12px;width:90vw;max-width:700px;height:85vh;max-height:750px;position:relative;overflow:hidden;";let u=document.createElement("button");u.textContent="\u2715",u.style.cssText="position:absolute;top:12px;right:16px;z-index:10;background:none;border:none;font-size:20px;cursor:pointer;color:#333;",u.addEventListener("click",G);let m=document.createElement("div");m.id="calendly-embed-container",m.style.cssText="width:100%;height:100%;",c.appendChild(u),c.appendChild(m),s.appendChild(c),document.body.appendChild(s),s.addEventListener("click",y=>{y.target===s&&G()}),setTimeout(()=>{s.style.opacity="1"},10),ue(t,i),_e()}function ue(e,t){let i=document.getElementById("calendly-embed-container");if(!i)return;let s=Ce+"?hide_gdpr_banner=1";e&&(s+="&name="+encodeURIComponent(e)),t&&(s+="&email="+encodeURIComponent(t));let c=document.createElement("div");if(c.className="calendly-inline-widget",c.setAttribute("data-url",s),c.style.cssText="min-width:100%;height:100%;",i.appendChild(c),document.querySelector('script[src*="assets.calendly.com"]'))window.Calendly&&window.Calendly.initInlineWidget({url:s,parentElement:i});else{let u=document.createElement("script");u.src="https://assets.calendly.com/assets/external/widget.js",u.async=!0,document.body.appendChild(u)}l.log("Calendly widget injected with name:",e,"email:",t)}function _e(){window.addEventListener("message",e=>{var t,i,s,c,u;if(e.origin==="https://calendly.com"&&((t=e.data)==null?void 0:t.event)==="calendly.event_scheduled"){l.log("Calendly event scheduled:",e.data);let m=I(),y={userId:(m==null?void 0:m.id)||localStorage.getItem("userId"),userName:(m==null?void 0:m.name)||localStorage.getItem("userName"),userEmail:(m==null?void 0:m.email)||localStorage.getItem("userEmail"),eventUri:(s=(i=e.data.payload)==null?void 0:i.event)==null?void 0:s.uri,inviteeUri:(u=(c=e.data.payload)==null?void 0:c.invitee)==null?void 0:u.uri,scheduledAt:new Date().toISOString()};l.log("Booking data:",y),localStorage.setItem("lastBooking",JSON.stringify(y)),setTimeout(()=>{G(),S("Termin erfolgreich gebucht!","success")},1500)}})}function G(){let e=document.getElementById("calendly-modal-overlay");e&&(e.style.opacity="0",setTimeout(()=>{e.style.display="none"},300),l.log("Calendly modal closed"))}function H(){let e=document.getElementById("nav-user-dropdown");e&&e.remove()}function Te(e){H();let t=I();if(!t)return;let i=document.createElement("div");i.id="nav-user-dropdown",i.style.cssText="position:absolute;top:100%;right:0;margin-top:8px;background:#1a1a2e;color:#fff;border-radius:10px;padding:16px 20px;min-width:220px;z-index:9999;box-shadow:0 8px 24px rgba(0,0,0,0.3);font-family:inherit;";let s=document.createElement("div");s.textContent=t.name||"",s.style.cssText="font-size:15px;font-weight:600;margin-bottom:4px;";let c=document.createElement("div");c.textContent=t.email||"",c.style.cssText="font-size:13px;opacity:0.7;margin-bottom:14px;";let u=document.createElement("button");u.textContent="Abmelden",u.setAttribute("data-auth-logout",""),u.style.cssText="display:block;width:100%;padding:8px 0;background:none;border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff;font-size:14px;cursor:pointer;transition:background 0.2s;",u.addEventListener("mouseenter",()=>{u.style.background="rgba(255,255,255,0.1)"}),u.addEventListener("mouseleave",()=>{u.style.background="none"}),i.appendChild(s),i.appendChild(c),i.appendChild(u);let m=e.closest(".nav_user")||e;m.style.position="relative",m.appendChild(i)}function Oe(){let e=window.location.pathname;e==="/"||e==="/en"||e==="/en/"||e.includes("/vision")||document.addEventListener("click",i=>{let s=i.target.closest(".nav_user");if(!s){H();return}i.preventDefault(),V()?document.getElementById("nav-user-dropdown")?H():Te(s):de()})}function Ie(){document.addEventListener("click",e=>{e.target.closest("[data-auth-logout]")&&(e.preventDefault(),H(),oe(),U(),S("Erfolgreich abgemeldet","info"),l.log("User logged out via button"))})}function ge(){l.log("Initializing global auth module"),Be(),Ie(),Oe(),U(),window.Auth={isAuthenticated:V,getCurrentUser:I,login:te,register:ee,verifyEmail:ne,resendCode:ie,logout:oe,openModal:de,closeModal:J,openCalendly:ce,closeCalendly:G,updateUI:U},l.log("Global auth module ready. Use Auth.openModal() to open.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",ge):ge()})();})();
