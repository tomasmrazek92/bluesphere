"use strict";(()=>{(function(){let x={DEBUG:!1,API_URL:"https://lth-waitlist-dev.orangegrass-967fbaa9.germanywestcentral.azurecontainerapps.io/api/waitlist/signup"},q=(...a)=>x.DEBUG&&console.log("[FORM-SUBMISSION]",...a);function P(){return window.location.pathname.includes("/en")}function f(a,t){typeof dataLayer!="undefined"&&dataLayer.push({event:a,...t})}function R(a){let t={high_engagement:"Based on your interest, you'll receive premium health insights and early access.",medium_engagement:"You'll receive our health education series and personalized tips.",low_engagement:"You'll receive essential health updates and wellness tips.",default:"You'll receive personalized health insights tailored to your interests."};return t[a]||t.default}function E(a,t){document.querySelectorAll(".form-error-message").forEach(c=>c.remove());let d=document.createElement("div");d.className="form-error-message",d.style.cssText="color: #ef4444; background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 12px 16px; margin: 16px 0; font-size: 14px; line-height: 1.5; z-index: 1000; position: relative;",d.textContent=t;try{a.firstElementChild?a.insertBefore(d,a.firstElementChild):a.appendChild(d)}catch(c){console.error("Error inserting error message:",c),alert(t);return}try{d.scrollIntoView({behavior:"smooth",block:"center"})}catch(c){console.error("Scroll error:",c)}a.style.display="block";let h=document.querySelector(".form-success-message");h&&(h.style.display="none");let u=document.querySelector(".w-form-done");u&&(u.style.display="none");let l=document.querySelector(".form_modal-form-sucess");if(l&&(l.style.display="none"),t.toLowerCase().includes("email")){let c=a.querySelector('input[type="email"], input[name*="email"]');c&&setTimeout(()=>{c.focus(),c.select()},500)}}function C(a,t){let _=document.querySelector("#wf-form-Waitlist-Form"),d=document.querySelector(".form-success-message");_&&(_.style.display="none"),d&&(d.style.display="block")}function D(){document.querySelectorAll("#wf-form-Waitlist-Form").forEach(function(t,_){if(!(t.querySelector('input[name="Postleitzahl"], input[name="zip"]')||t.querySelector('select[name="gender"], select[name="Gender"], select[name="Geschlecht"]')||t.querySelector('#country, select[name="country"]')))return;t.querySelectorAll(".w-form-done").forEach(l=>{l.style.display="none",l.remove()}),t.querySelectorAll(".w-form-fail").forEach(l=>{l.style.display="none",l.remove()});let h=!1;t.addEventListener("focus",function(l){!h&&l.target.tagName==="INPUT"&&(h=!0,f("form_start",{form_name:"waitlist_signup",form_id:t.id||"form_"+_}))},!0);let u=!1;t.addEventListener("submit",function(l){var c,M,V;l.preventDefault();try{if(u)return!1;f("form_submit_attempt",{form_name:"waitlist_signup"});let F=new FormData(t),s={};for(let e of F.entries())s[e[0]]=e[1];let T=s["first-name"]||s["First-Name"]||s.firstName||s.FirstName||"",L=s["last-name"]||s["Last-Name"]||s.lastName||s.LastName||"",g=s.gender||s.Gender||s.Geschlecht||"",b=g;g==="Divers"||g==="divers"||g==="diverse"?b="other":g==="M\xE4nnlich"||g==="m\xE4nnlich"?b="male":(g==="Weiblich"||g==="weiblich")&&(b="female");let n={email:s.email||s.Email||"",name:(T+" "+L).trim()||s.name||s.Name||"",gender:b,city:s.city||s.City||s.Stadt||"",country:s.country||s.Country||s.Land||"",zip_code:s.Postleitzahl||s.zip||s.Zip||s.ZIP||""},y=!1;if(!n.email){let e=t.querySelector('input[type="email"], input[name="email"], input[name="Email"]');e&&e.dispatchEvent(new Event("blur",{bubbles:!0})),y=!0}if(!n.gender){let e=t.querySelector('select[name="gender"], select[name="Gender"], select[name="Geschlecht"]');if(e){let o=e.closest(".form_field");if(o){let r=o.querySelector(".form_validation");r&&window.FormValidator&&(r.textContent=window.FormValidator.getErrorMessage("gender_required"),r.classList.add("show"))}}y=!0}if(!n.country){let e=t.querySelector('#country, select[name="country"], select[name="Country"]');if(e){let o=e.closest(".form_field");if(o){let r=o.querySelector(".form_validation");r&&window.FormValidator&&(r.textContent=window.FormValidator.getErrorMessage("country_required"),r.classList.add("show"))}}y=!0}let I=t.querySelector('input[type="checkbox"][name="checkbox"]');if(I&&!I.checked){let e=(c=I.closest(".form_field-wrap"))==null?void 0:c.querySelector(".form_validation");e&&e.classList.add("show"),y=!0}if(!n.zip_code){let e=t.querySelector('input[name="Postleitzahl"], input[name="zip"], input[name="Zip"]');e&&e.dispatchEvent(new Event("blur",{bubbles:!0})),y=!0}if(y)return E(t,((M=window.FormValidator)==null?void 0:M.getErrorMessage("generic_error"))||"Please fill all fields"),u=!1,!1;if(n.zip_code&&n.country&&window.zipPatterns){let e=window.zipPatterns[n.country];if(e){let o=e.pattern.test(n.zip_code);if(e.min&&e.max){let r=parseInt(n.zip_code);o=o&&r>=e.min&&r<=e.max}if(!o){let r=window.translateZipFormat?window.translateZipFormat(e.format):e.format,v=window.FormValidator.getErrorMessage("zip_invalid").replace("{country}",n.country).replace("{format}",r);E(t,v),f("form_validation_error",{error_type:"invalid_zip",country:n.country});let w=t.querySelector('input[name="Postleitzahl"], input[name="zip"], input[name="Zip"]');return w&&setTimeout(()=>{w.focus(),w.select()},100),u=!1,!1}}}let i=t.querySelector('input[type="submit"], button[type="submit"], .w-button'),z=i?i.textContent||i.value:"";u=!0,window.FormValidator&&(window.FormValidator.CAN_SUBMIT=!0),i&&(i.textContent="Please wait...",i.disabled=!0,i.style.opacity="0.6",i.setAttribute("data-submitting","true")),n.email&&(sessionStorage.setItem("userEmail",n.email),document.querySelectorAll("[data-user-email]").forEach(e=>{e.textContent=n.email}));let m=JSON.parse(sessionStorage.getItem("bluesphere_user_profile")||"{}"),S=new URLSearchParams(window.location.search),B={utm_source:S.get("utm_source")||sessionStorage.getItem("utm_source")||"",utm_medium:S.get("utm_medium")||sessionStorage.getItem("utm_medium")||"",utm_campaign:S.get("utm_campaign")||sessionStorage.getItem("utm_campaign")||"",utm_term:S.get("utm_term")||sessionStorage.getItem("utm_term")||"",utm_content:S.get("utm_content")||sessionStorage.getItem("utm_content")||""},p={email:n.email,name:n.name||void 0,gender:n.gender||void 0,city:n.city||void 0,country:n.country||void 0,zip_code:n.zip_code||void 0,language:P()?"en":"de"};Object.keys(p).forEach(e=>{(p[e]===void 0||p[e]==="")&&delete p[e]});let O={...p,engagement_score:m.engagement_score||0,user_segment:m.segment||"unknown",time_on_site:m.time_on_site||0,scroll_depth:m.scroll_depth||0,sections_viewed:m.sections_viewed||[],...B,referrer:document.referrer||"direct",landing_page:window.location.pathname,timestamp:new Date().toISOString(),timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,language:navigator.language,device_type:/Mobile|Android|iPhone/i.test(navigator.userAgent)?"mobile":"desktop"};localStorage.setItem("bluesphere_last_submission",JSON.stringify(O)),localStorage.setItem("bluesphere_submission_time",Date.now().toString()),localStorage.setItem("bluesphere_submission_pending","true");let k=Date.now().toString(),U=k+"."+JSON.stringify(p),G=new TextEncoder().encode(U),Z="client_signature_"+btoa(String.fromCharCode.apply(null,G)).replace(/[^a-zA-Z0-9]/g,"");fetch(x.API_URL,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","X-Signature":Z,"X-Timestamp":k},body:JSON.stringify(p)}).then(e=>e.ok?e.json():e.text().then(o=>{console.error("Backend error response:",e.status,o);try{let r=JSON.parse(o);throw new Error(r.message||"Backend error")}catch{throw new Error("Backend responded with status: "+e.status)}})).then(e=>{localStorage.removeItem("bluesphere_submission_pending"),(e.userId||e.user_id)&&sessionStorage.setItem("bluesphere_user_id",e.userId||e.user_id),f("waitlist_conversion",{user_id:e.userId||e.user_id||null,email:n.email,segment:m.segment||"unknown",engagement_score:m.engagement_score||0,value:m.engagement_score||0,currency:"EUR"}),f("generate_lead",{value:m.engagement_score||0,currency:"EUR"}),f("waitlist_signup_success",{method:"form",user_segment:m.segment||"unknown"}),C(n,m.segment),setTimeout(()=>{i&&(i.textContent=z,i.disabled=!1,i.style.opacity="1",i.removeAttribute("data-submitting")),u=!1,window.FormValidator&&(window.FormValidator.CAN_SUBMIT=!1)},2e3)}).catch(e=>{var r,v,w,A;let o=((r=window.FormValidator)==null?void 0:r.getErrorMessage("generic_error"))||"Something went wrong";if(e.message.includes("Failed to fetch")&&!e.message.includes("Backend error")&&!e.message.includes("500")&&!e.message.includes("400")&&!e.message.includes("409")){C(n,m.segment),setTimeout(()=>{i&&(i.textContent=z,i.disabled=!1,i.style.opacity="1"),u=!1},2e3);return}else e.message.includes("Network")?o=((v=window.FormValidator)==null?void 0:v.getErrorMessage("network_error"))||"Network error":e.message.includes("email")||e.message.includes("duplicate")||e.message.includes("already exists")||e.message.includes("unique constraint")||e.message.includes("already registered")?o=((w=window.FormValidator)==null?void 0:w.getErrorMessage("email_exists"))||"Email already exists":e.message.includes("An error occurred during signup")&&(o=((A=window.FormValidator)==null?void 0:A.getErrorMessage("signup_error"))||"Signup error");f("form_submission_error",{error_type:e.message,form_name:"waitlist_signup"}),E(t,e.message.includes("Backend error")?o:e.message),i&&(i.textContent=z,i.disabled=!1,i.style.opacity="1",i.removeAttribute("data-submitting")),u=!1,window.FormValidator&&(window.FormValidator.CAN_SUBMIT=!1)})}catch(F){console.error("Form submission error:",F),alert(((V=window.FormValidator)==null?void 0:V.getErrorMessage("generic_error"))||"Something went wrong"),u=!1,window.FormValidator&&(window.FormValidator.CAN_SUBMIT=!1)}})})}function N(){q("Initializing global form submission"),setTimeout(D,1e3),q("Global form submission ready")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",N):N()})();})();
