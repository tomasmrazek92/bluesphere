"use strict";(()=>{(function(){let f={DEBUG:!0,CART_KEY:"wf_cart_v3",CHECKOUT_URL:"/deine-bestellung"},I={"package-mens-health":"mens_health","package-womens-health":"womens_health","package-chronic-inflammation":"chronic_inflammation","package-eisenmetabolismus":"iron_metabolism","package-heart-health":"heart_health","package-vitamin-b-stoffwechsel":"vitamin_b_metabolism","package-vitamin-d":"vitamin_d","package-longterm-health":"longterm_health"},h={mens_health:{name:"M\xE4nnergesundheit",basePrice:8743,image:"",biomarkers:{lh:{name:"LH",price:1457},fsh:{name:"FSH",price:1457},prolactin:{name:"Prolaktin",price:1e3},estradiol:{name:"Estradiol",price:1360},dheas:{name:"DHEAS",price:1360},shbg:{name:"SHBG",price:1749},testosterone:{name:"Testosterone",price:1360},free_testosterone_index:{name:"Free Testosterone Index",price:1e3}}},womens_health:{name:"Frauengesundheit",basePrice:12143,image:"",biomarkers:{progesterone:{name:"Progesterone",price:1360},estradiol:{name:"Estradiol",price:1360},fsh:{name:"FSH",price:1457},lh:{name:"LH",price:1457},dheas:{name:"DHEAS",price:1360},shbg:{name:"SHBG",price:1749},testosterone:{name:"Testosterone",price:1360},free_testosterone_index:{name:"Free Testosterone Index",price:1e3},ferritin:{name:"Ferritin",price:1457},transferrin:{name:"Transferrin",price:583}}},chronic_inflammation:{name:"Chronische Entz\xFCndung",basePrice:3332,image:"",biomarkers:{hscrp:{name:"hsC-reaktive Protein",price:1166},neutrophile_granulozyten:{name:"Neutrophile Granulozyten",price:1166},interleukin_6:{name:"Interleukin-6",price:1e3}}},iron_metabolism:{name:"Eisen-Metabolismus",basePrice:2873,image:"",biomarkers:{ferritin:{name:"Ferritin",price:1457},transferrin:{name:"Transferrin",price:583},eisen:{name:"Eisen",price:233},transferrin_saettigung:{name:"Transferrin-S\xE4ttigung",price:600}}},heart_health:{name:"Herzgesundheit",basePrice:4498,image:"",biomarkers:{apo_b:{name:"APO B",price:2332},hscrp:{name:"hsC-reaktive Protein",price:1166},lpa:{name:"Lp(a)",price:1e3}}},vitamin_b_metabolism:{name:"Vitamin B Stoffwechsel",basePrice:9236,image:"",biomarkers:{vitamin_b2:{name:"Vitamin B2",price:3322},vitamin_b12:{name:"Vitamin B12",price:1457},vitamin_b9:{name:"Vitamin B9 (Fols\xE4ure)",price:1457},vitamin_b6:{name:"Vitamin B6",price:3322}}},vitamin_d:{name:"Vitamin D",basePrice:1865,image:"",biomarkers:{vitamin_d_25oh:{name:"Vitamin D 25OH",price:1865}}},longterm_health:{name:"Longterm Health",basePrice:3964,image:"",biomarkers:{hba1c:{name:"HbA1C",price:1166},crp:{name:"CRP",price:1166},alat:{name:"ALAT",price:233},cystatin_c:{name:"Cystatin C",price:1166},ldl:{name:"LDL",price:233}}}},i=(...e)=>f.DEBUG&&console.log("[CART-MODAL]",...e),c=(e,t=document)=>t.querySelector(e),b=(e,t=document)=>[...t.querySelectorAll(e)],P=e=>new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e/100),u=()=>{try{return JSON.parse(localStorage.getItem(f.CART_KEY)||"[]")}catch{return[]}},T=e=>{localStorage.setItem(f.CART_KEY,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cart-updated"))},L=()=>{localStorage.removeItem(f.CART_KEY),window.dispatchEvent(new CustomEvent("cart-updated"))};function S(e){let t=new Map,a=0,s=0,r=[];return e.forEach(n=>{let l=h[n.sku];if(!l)return;let o=l.basePrice;Object.entries(l.biomarkers).forEach(([m,d])=>{t.has(m)?(o-=d.price,s+=d.price):t.set(m,l.name)}),r.push({sku:n.sku,name:l.name,original:l.basePrice,final:o}),a+=o}),{total:a,deductions:s,prices:r,original:e.reduce((n,l)=>{var o;return n+(((o=h[l.sku])==null?void 0:o.basePrice)||0)},0)}}let w=null,_=null,g=null;function C(){return w||(w=c(".cart-modal")),w}function v(){let e=C();if(!e){i("Cart modal not found in DOM");return}e.style.display="flex",setTimeout(()=>{e.style.opacity="1";let t=c(".cart_modal-box",e);t&&(t.style.opacity="1",t.style.transform="translate3d(0rem, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg)")},10),k(),i("Cart modal opened")}function y(){let e=C();if(!e)return;let t=c(".cart_modal-box",e);t&&(t.style.opacity="0",t.style.transform="translate3d(2rem, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg)"),setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.style.display="none"},200)},100),i("Cart modal closed")}function k(){let e=C();if(!e)return;let t=u(),a=S(t);if(i("Rendering cart modal:",t.length,"items"),g=c(".cart_modal-list",e),!g){i("List container not found");return}if(!_){let r=c(".cart_modal-list_item",g);r&&(_=r.cloneNode(!0),i("Item template initialized"))}if(b(".cart_modal-list_item",g).forEach(r=>r.remove()),t.length===0){let r=document.createElement("li");r.className="cart_modal-list_item",r.innerHTML='<div class="cart_modal-list_item-inner" style="justify-content: center; padding: 2rem;"><div class="text-color-gray-70"><div class="text-size-small">Warenkorb ist leer</div></div></div>',g.appendChild(r)}else _&&t.forEach(r=>{let n=h[r.sku];if(!n)return;let l=a.prices.find(p=>p.sku===r.sku),o=_.cloneNode(!0);o.setAttribute("data-sku",r.sku);let m=c('[data-cart="cart-item-img"]',o);if(m){let p=r.image||n.image;p&&(m.src=p,m.removeAttribute("srcset"),m.removeAttribute("sizes")),m.alt=n.name}let d=c('[data-cart="cart-item-title"]',o);d&&(d.textContent=n.name);let H=c('[data-cart="cart-item-desc"]',o);H&&(H.textContent=`${Object.keys(n.biomarkers).length} Biomarker`);let F=c('[data-cart="cart-item-price"]',o);F&&(F.textContent=P((l==null?void 0:l.final)||n.basePrice));let x=c('[data-cart="cart-item-remove"]',o);x&&(x.style.cursor="pointer",x.addEventListener("click",p=>{p.preventDefault(),p.stopPropagation(),A(r.sku)})),g.appendChild(o)});let s=c(".cart_modal-price_wrap .heading-style-h4",e);s&&(s.textContent=P(a.total)),b("[data-cart-count]").forEach(r=>{r.textContent=t.length}),i("Cart modal render complete")}function A(e){let t=u().filter(a=>a.sku!==e);T(t),k(),E("Paket entfernt","info"),i("Removed from cart:",e)}function D(e,t){let a=u();if(!a.find(s=>s.sku===e)){let s={sku:e,addedAt:Date.now()};t&&(s.image=t),a.push(s),T(a),E("Paket hinzugef\xFCgt","success")}v()}function E(e,t="info"){if(window.Notification&&typeof window.Notification.show=="function"){window.Notification.show(e,t);return}let a=document.createElement("div");a.style.cssText=`position:fixed;top:20px;right:20px;padding:16px 24px;background:${t==="success"?"#00a86b":t==="error"?"#dc3545":"#333"};color:white;border-radius:8px;z-index:10001;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.15);transition:opacity 0.3s;`,a.textContent=e,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>a.remove(),300)},3e3)}function M(){let e=C();if(!e){i("Cart modal not found, skipping setup");return}e.style.display="none",e.style.opacity="0";let t=c(".cart_moda-box_close-button",e);t&&(t.style.cursor="pointer",t.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),y()}),i("Close button initialized"));let a=c(".cart_modal-bg",e);a&&(a.style.cursor="pointer",a.addEventListener("click",n=>{n.preventDefault(),y()}),i("Background click handler initialized"));let s=c(".button.is-link.is-secondary",e);s&&(s.style.cursor="pointer",s.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),L(),k(),E("Warenkorb geleert","info")}),i("Clear cart button initialized"));let r=c(".cart_modal-list_item-button_wrap .button:not(.is-secondary)",e);r&&(r.addEventListener("click",n=>{if(n.preventDefault(),n.stopPropagation(),u().length===0){E("Warenkorb ist leer","error");return}window.location.href=f.CHECKOUT_URL}),i("Checkout button initialized")),document.addEventListener("keydown",n=>{n.key==="Escape"&&e.style.display!=="none"&&y()}),i("Cart modal setup complete")}function N(){let e=b('[data-cart-trigger], [data-cart="open"], .cart-icon, .cart-trigger, [href="#cart"]');e.forEach(t=>{t.style.cursor="pointer",t.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),v()})}),i("Cart triggers initialized:",e.length),document.addEventListener("click",t=>{t.target.closest("[data-cart-trigger], [data-open-cart]")&&(t.preventDefault(),t.stopPropagation(),v())})}function B(){let e=u();b("[data-cart-count]").forEach(t=>{t.textContent=e.length})}function O(){let t=window.location.pathname.replace(/\/$/,"").split("/").pop(),a=I[t];if(!a){i("Not a package page or unknown slug:",t);return}if(!h[a]){i("Package not found for SKU:",a);return}i("Package page detected:",t,"-> SKU:",a),b('[data-cart="add-to-cart"], [data-add-to-cart], [data-hero="item"]').forEach(n=>{n.textContent.toLowerCase().includes("warenkorb")&&(i("Found add-to-cart button:",n),n.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation();let m=c("section img.cover-img, .b-test_head img.cover-img"),d=m?m.src:"";i("Add to cart clicked for package:",a,"image:",d),D(a,d)}))})}function z(){i("Initializing global cart modal"),M(),N(),O(),B(),window.addEventListener("cart-updated",()=>{k(),B()}),window.CartModal={open:v,close:y,render:k,getItems:u,clear:L,add:D,remove:A,calculate:S,PACKAGES:h},i("Global cart modal ready. Use CartModal.open() to open.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",z):z()})();})();
