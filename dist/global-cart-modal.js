"use strict";(()=>{(function(){let b={DEBUG:!0,CART_KEY:"wf_cart_v3",CHECKOUT_URL:"/deine-bestellung"},L={"package-mens-health":"mens_health","package-womens-health":"womens_health","package-chronic-inflammation":"chronic_inflammation","package-eisenmetabolismus":"iron_metabolism","package-heart-health":"heart_health","package-vitamin-b-stoffwechsel":"vitamin_b_metabolism","package-vitamin-d":"vitamin_d","longterm-health":"longterm_health"},u={mens_health:{name:"M\xE4nnergesundheit",basePrice:8743,image:"",biomarkers:{lh:{name:"LH",price:1457},fsh:{name:"FSH",price:1457},prolactin:{name:"Prolaktin",price:1e3},estradiol:{name:"Estradiol",price:1360},dheas:{name:"DHEAS",price:1360},shbg:{name:"SHBG",price:1749},testosterone:{name:"Testosterone",price:1360},free_testosterone_index:{name:"Free Testosterone Index",price:1e3}}},womens_health:{name:"Frauengesundheit",basePrice:12143,image:"",biomarkers:{progesterone:{name:"Progesterone",price:1360},estradiol:{name:"Estradiol",price:1360},fsh:{name:"FSH",price:1457},lh:{name:"LH",price:1457},dheas:{name:"DHEAS",price:1360},shbg:{name:"SHBG",price:1749},testosterone:{name:"Testosterone",price:1360},free_testosterone_index:{name:"Free Testosterone Index",price:1e3},ferritin:{name:"Ferritin",price:1457},transferrin:{name:"Transferrin",price:583}}},chronic_inflammation:{name:"Chronische Entz\xFCndung",basePrice:3332,image:"",biomarkers:{hscrp:{name:"hsC-reaktive Protein",price:1166},neutrophile_granulozyten:{name:"Neutrophile Granulozyten",price:1166},interleukin_6:{name:"Interleukin-6",price:1e3}}},iron_metabolism:{name:"Eisen-Metabolismus",basePrice:2873,image:"",biomarkers:{ferritin:{name:"Ferritin",price:1457},transferrin:{name:"Transferrin",price:583},eisen:{name:"Eisen",price:233},transferrin_saettigung:{name:"Transferrin-S\xE4ttigung",price:600}}},heart_health:{name:"Herzgesundheit",basePrice:4498,image:"",biomarkers:{apo_b:{name:"APO B",price:2332},hscrp:{name:"hsC-reaktive Protein",price:1166},lpa:{name:"Lp(a)",price:1e3}}},vitamin_b_metabolism:{name:"Vitamin B Stoffwechsel",basePrice:9236,image:"",biomarkers:{vitamin_b2:{name:"Vitamin B2",price:3322},vitamin_b12:{name:"Vitamin B12",price:1457},vitamin_b9:{name:"Vitamin B9 (Fols\xE4ure)",price:1457},vitamin_b6:{name:"Vitamin B6",price:3322}}},vitamin_d:{name:"Vitamin D",basePrice:1865,image:"",biomarkers:{vitamin_d_25oh:{name:"Vitamin D 25OH",price:1865}}},longterm_health:{name:"Longterm Health",basePrice:3964,image:"",biomarkers:{hba1c:{name:"HbA1C",price:1166},crp:{name:"CRP",price:1166},alat:{name:"ALAT",price:233},cystatin_c:{name:"Cystatin C",price:1166},ldl:{name:"LDL",price:233}}}},c=(...e)=>b.DEBUG&&console.log("[CART-MODAL]",...e),i=(e,t=document)=>t.querySelector(e),k=(e,t=document)=>[...t.querySelectorAll(e)],S=e=>new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e/100),f=()=>{try{return JSON.parse(localStorage.getItem(b.CART_KEY)||"[]")}catch{return[]}},A=e=>{localStorage.setItem(b.CART_KEY,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cart-updated"))},D=()=>{localStorage.removeItem(b.CART_KEY),window.dispatchEvent(new CustomEvent("cart-updated"))};function B(e){let t=new Map,a=0,s=0,n=[];return e.forEach(o=>{let l=u[o.sku];if(!l)return;let r=l.basePrice;Object.entries(l.biomarkers).forEach(([m,d])=>{t.has(m)?(r-=d.price,s+=d.price):t.set(m,l.name)}),n.push({sku:o.sku,name:l.name,original:l.basePrice,final:r}),a+=r}),{total:a,deductions:s,prices:n,original:e.reduce((o,l)=>{var r;return o+(((r=u[l.sku])==null?void 0:r.basePrice)||0)},0)}}let P=null,p=null,h=null;function C(){return P||(P=i(".cart-modal")),P}function y(){let e=C();if(!e){c("Cart modal not found in DOM");return}e.style.display="flex",setTimeout(()=>{e.style.opacity="1";let t=i(".cart_modal-box",e);t&&(t.style.opacity="1",t.style.transform="translate3d(0rem, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg)")},10),_(),c("Cart modal opened")}function E(){let e=C();if(!e)return;let t=i(".cart_modal-box",e);t&&(t.style.opacity="0",t.style.transform="translate3d(2rem, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg)"),setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.style.display="none"},200)},100),c("Cart modal closed")}function _(){let e=C();if(!e)return;let t=f(),a=B(t);if(c("Rendering cart modal:",t.length,"items"),h=i(".cart_modal-list",e),!h){c("List container not found");return}if(!p){let n=i(".cart_modal-list_item",h);n&&(p=n.cloneNode(!0),c("Item template initialized, innerHTML:",p.innerHTML.substring(0,200)),c("Template has data-cart attrs:",{img:!!i('[data-cart="cart-item-img"]',p),title:!!i('[data-cart="cart-item-title"]',p),desc:!!i('[data-cart="cart-item-desc"]',p),price:!!i('[data-cart="cart-item-price"]',p),remove:!!i('[data-cart="cart-item-remove"]',p)}))}if(k(".cart_modal-list_item",h).forEach(n=>n.remove()),t.length===0){let n=document.createElement("li");n.className="cart_modal-list_item",n.innerHTML='<div class="cart_modal-list_item-inner" style="justify-content: center; padding: 2rem;"><div class="text-color-gray-70"><div class="text-size-small">Warenkorb ist leer</div></div></div>',h.appendChild(n)}else p&&t.forEach(n=>{let o=u[n.sku];if(!o)return;let l=a.prices.find(g=>g.sku===n.sku),r=p.cloneNode(!0);r.setAttribute("data-sku",n.sku);let m=i('[data-cart="cart-item-img"]',r)||i("img",r);if(m){let g=n.image||o.image;g&&(m.src=g,m.removeAttribute("srcset"),m.removeAttribute("sizes")),m.alt=o.name}let d=i('[data-cart="cart-item-title"]',r)||i(".cart_modal-list_item-title",r)||i(".heading-style-h6",r)||i(".heading-style-h5",r);d&&(d.textContent=o.name);let F=i('[data-cart="cart-item-desc"]',r)||i(".cart_modal-list_item-desc",r)||i(".text-size-small",r);F&&(F.textContent=`${Object.keys(o.biomarkers).length} Biomarker`);let v=i('[data-cart="cart-item-price"]',r)||i(".cart_modal-list_item-price",r)||i(".cart_modal-list_item-box .heading-style-h4",r);v&&(v.textContent=S((l==null?void 0:l.final)||o.basePrice));let x=i('[data-cart="cart-item-remove"]',r)||i(".cart_modal-list_item-remove",r)||i('[class*="remove"]',r)||i('[class*="trash"]',r)||i('[class*="delete"]',r);x&&(x.style.cursor="pointer",x.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),H(n.sku)})),c("Rendered item:",n.sku,{title:d==null?void 0:d.textContent,price:v==null?void 0:v.textContent,img:!!m,trash:!!x,elHTML:r.innerHTML.substring(0,500)}),h.appendChild(r)});let s=i(".cart_modal-price_wrap .heading-style-h4",e);s&&(s.textContent=S(a.total)),k("[data-cart-count]").forEach(n=>{n.textContent=t.length}),c("Cart modal render complete")}function H(e){let t=f().filter(a=>a.sku!==e);A(t),_(),w("Paket entfernt","info"),c("Removed from cart:",e)}function T(e,t){let a=f();if(!a.find(s=>s.sku===e)){let s={sku:e,addedAt:Date.now()};t&&(s.image=t),a.push(s),A(a),w("Paket hinzugef\xFCgt","success")}y()}function w(e,t="info"){if(window.Notification&&typeof window.Notification.show=="function"){window.Notification.show(e,t);return}let a=document.createElement("div");a.style.cssText=`position:fixed;top:20px;right:20px;padding:16px 24px;background:${t==="success"?"#00a86b":t==="error"?"#dc3545":"#333"};color:white;border-radius:8px;z-index:10001;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.15);transition:opacity 0.3s;`,a.textContent=e,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>a.remove(),300)},3e3)}function I(){let e=C();if(!e){c("Cart modal not found, skipping setup");return}e.style.display="none",e.style.opacity="0";let t=i(".cart_moda-box_close-button",e);t&&(t.style.cursor="pointer",t.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),E()}),c("Close button initialized"));let a=i(".cart_modal-bg",e);a&&(a.style.cursor="pointer",a.addEventListener("click",o=>{o.preventDefault(),E()}),c("Background click handler initialized"));let s=i(".button.is-link.is-secondary",e);s&&(s.style.cursor="pointer",s.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),D(),_(),w("Warenkorb geleert","info")}),c("Clear cart button initialized"));let n=i(".cart_modal-list_item-button_wrap .button:not(.is-secondary)",e);n&&(n.addEventListener("click",o=>{if(o.preventDefault(),o.stopPropagation(),f().length===0){w("Warenkorb ist leer","error");return}window.location.href=b.CHECKOUT_URL}),c("Checkout button initialized")),document.addEventListener("keydown",o=>{o.key==="Escape"&&e.style.display!=="none"&&E()}),c("Cart modal setup complete")}function N(){let e=k('[data-cart-trigger], [data-cart="open"], .cart-icon, .cart-trigger, [href="#cart"]');e.forEach(t=>{t.style.cursor="pointer",t.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),y()})}),c("Cart triggers initialized:",e.length),document.addEventListener("click",t=>{t.target.closest("[data-cart-trigger], [data-open-cart]")&&(t.preventDefault(),t.stopPropagation(),y())}),document.addEventListener("click",t=>{let a=t.target.closest('[data-packages="btn-buy"]');if(!a)return;t.preventDefault(),t.stopPropagation();let s=a.closest("[data-package-sku]"),n=s?s.getAttribute("data-package-sku"):null;if(n||(n=a.getAttribute("data-package-sku")),!n){let m=window.location.pathname.replace(/\/$/,"").split("/").pop();n=L[m]}if(!n||!u[n]){c("Buy button clicked but no valid SKU found");return}let o=u[n],l=s?s.querySelector('[data-packages="img"]')||s.querySelector("img"):document.querySelector("section img.cover-img, .b-test_head img.cover-img, img"),r=l?l.src:"";c("Global buy button clicked:",n,r),T(n,r)})}function M(){let e=f();k("[data-cart-count]").forEach(t=>{t.textContent=e.length})}function O(){let t=window.location.pathname.replace(/\/$/,"").split("/").pop(),a=L[t];if(!a){c("Not a package page or unknown slug:",t);return}if(!u[a]){c("Package not found for SKU:",a);return}c("Package page detected:",t,"-> SKU:",a),k('[data-cart="add-to-cart"], [data-add-to-cart], [data-hero="item"]').forEach(o=>{o.textContent.toLowerCase().includes("warenkorb")&&(c("Found add-to-cart button:",o),o.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation();let m=i("section img.cover-img, .b-test_head img.cover-img"),d=m?m.src:"";c("Add to cart clicked for package:",a,"image:",d),T(a,d)}))})}function z(){c("Initializing global cart modal"),I(),N(),O(),M(),window.addEventListener("cart-updated",()=>{_(),M()}),window.CartModal={open:y,close:E,render:_,getItems:f,clear:D,add:T,remove:H,calculate:B,PACKAGES:u},c("Global cart modal ready. Use CartModal.open() to open.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",z):z()})();})();
