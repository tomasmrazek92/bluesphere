"use strict";(()=>{(function(){let b={DEBUG:!0,CART_KEY:"wf_cart_v3",CHECKOUT_URL:"/deine-bestellung"},L={"package-mens-health":"mens_health","package-womens-health":"womens_health","package-chronic-inflammation":"chronic_inflammation","package-eisenmetabolismus":"iron_metabolism","package-heart-health":"heart_health","package-vitamin-b-stoffwechsel":"vitamin_b_metabolism","package-vitamin-d":"vitamin_d","longterm-health":"longterm_health"},u={mens_health:{name:"M\xE4nnergesundheit",basePrice:8743,image:"",biomarkers:{lh:{name:"LH",price:1457},fsh:{name:"FSH",price:1457},prolactin:{name:"Prolaktin",price:1e3},estradiol:{name:"Estradiol",price:1360},dheas:{name:"DHEAS",price:1360},shbg:{name:"SHBG",price:1749},testosterone:{name:"Testosterone",price:1360},free_testosterone_index:{name:"Free Testosterone Index",price:1e3}}},womens_health:{name:"Frauengesundheit",basePrice:12143,image:"",biomarkers:{progesterone:{name:"Progesterone",price:1360},estradiol:{name:"Estradiol",price:1360},fsh:{name:"FSH",price:1457},lh:{name:"LH",price:1457},dheas:{name:"DHEAS",price:1360},shbg:{name:"SHBG",price:1749},testosterone:{name:"Testosterone",price:1360},free_testosterone_index:{name:"Free Testosterone Index",price:1e3},ferritin:{name:"Ferritin",price:1457},transferrin:{name:"Transferrin",price:583}}},chronic_inflammation:{name:"Chronische Entz\xFCndung",basePrice:3332,image:"",biomarkers:{hscrp:{name:"hsC-reaktive Protein",price:1166},neutrophile_granulozyten:{name:"Neutrophile Granulozyten",price:1166},interleukin_6:{name:"Interleukin-6",price:1e3}}},iron_metabolism:{name:"Eisen-Metabolismus",basePrice:2873,image:"",biomarkers:{ferritin:{name:"Ferritin",price:1457},transferrin:{name:"Transferrin",price:583},eisen:{name:"Eisen",price:233},transferrin_saettigung:{name:"Transferrin-S\xE4ttigung",price:600}}},heart_health:{name:"Herzgesundheit",basePrice:4498,image:"",biomarkers:{apo_b:{name:"APO B",price:2332},hscrp:{name:"hsC-reaktive Protein",price:1166},lpa:{name:"Lp(a)",price:1e3}}},vitamin_b_metabolism:{name:"Vitamin B Stoffwechsel",basePrice:9236,image:"",biomarkers:{vitamin_b2:{name:"Vitamin B2",price:3322},vitamin_b12:{name:"Vitamin B12",price:1457},vitamin_b9:{name:"Vitamin B9 (Fols\xE4ure)",price:1457},vitamin_b6:{name:"Vitamin B6",price:3322}}},vitamin_d:{name:"Vitamin D",basePrice:1865,image:"",biomarkers:{vitamin_d_25oh:{name:"Vitamin D 25OH",price:1865}}},longterm_health:{name:"Longterm Health",basePrice:3964,image:"",biomarkers:{hba1c:{name:"HbA1C",price:1166},crp:{name:"CRP",price:1166},alat:{name:"ALAT",price:233},cystatin_c:{name:"Cystatin C",price:1166},ldl:{name:"LDL",price:233}}}},i=(...e)=>b.DEBUG&&console.log("[CART-MODAL]",...e),o=(e,t=document)=>t.querySelector(e),k=(e,t=document)=>[...t.querySelectorAll(e)],S=e=>new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e/100),f=()=>{try{return JSON.parse(localStorage.getItem(b.CART_KEY)||"[]")}catch{return[]}},A=e=>{localStorage.setItem(b.CART_KEY,JSON.stringify(e)),window.dispatchEvent(new CustomEvent("cart-updated"))},D=()=>{localStorage.removeItem(b.CART_KEY),window.dispatchEvent(new CustomEvent("cart-updated"))};function B(e){let t=new Map,a=0,s=0,n=[];return e.forEach(r=>{let l=u[r.sku];if(!l)return;let c=l.basePrice;Object.entries(l.biomarkers).forEach(([m,d])=>{t.has(m)?(c-=d.price,s+=d.price):t.set(m,l.name)}),n.push({sku:r.sku,name:l.name,original:l.basePrice,final:c}),a+=c}),{total:a,deductions:s,prices:n,original:e.reduce((r,l)=>{var c;return r+(((c=u[l.sku])==null?void 0:c.basePrice)||0)},0)}}let P=null,p=null,h=null;function C(){return P||(P=o(".cart-modal")),P}function y(){let e=C();if(!e){i("Cart modal not found in DOM");return}e.style.display="flex",setTimeout(()=>{e.style.opacity="1";let t=o(".cart_modal-box",e);t&&(t.style.opacity="1",t.style.transform="translate3d(0rem, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg)")},10),_(),i("Cart modal opened")}function E(){let e=C();if(!e)return;let t=o(".cart_modal-box",e);t&&(t.style.opacity="0",t.style.transform="translate3d(2rem, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg)"),setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.style.display="none"},200)},100),i("Cart modal closed")}function _(){let e=C();if(!e)return;let t=f(),a=B(t);if(i("Rendering cart modal:",t.length,"items"),h=o(".cart_modal-list",e),!h){i("List container not found");return}if(!p){let n=o(".cart_modal-list_item",h);n&&(p=n.cloneNode(!0),i("Item template initialized, innerHTML:",p.innerHTML.substring(0,200)),i("Template has data-cart attrs:",{img:!!o('[data-cart="cart-item-img"]',p),title:!!o('[data-cart="cart-item-title"]',p),desc:!!o('[data-cart="cart-item-desc"]',p),price:!!o('[data-cart="cart-item-price"]',p),remove:!!o('[data-cart="cart-item-remove"]',p)}))}if(k(".cart_modal-list_item",h).forEach(n=>n.remove()),t.length===0){let n=document.createElement("li");n.className="cart_modal-list_item",n.innerHTML='<div class="cart_modal-list_item-inner" style="justify-content: center; padding: 2rem;"><div class="text-color-gray-70"><div class="text-size-small">Warenkorb ist leer</div></div></div>',h.appendChild(n)}else p&&t.forEach(n=>{let r=u[n.sku];if(!r)return;let l=a.prices.find(g=>g.sku===n.sku),c=p.cloneNode(!0);c.setAttribute("data-sku",n.sku);let m=o('[data-cart="cart-item-img"]',c)||o("img",c);if(m){let g=n.image||r.image;g&&(m.src=g,m.removeAttribute("srcset"),m.removeAttribute("sizes")),m.alt=r.name}let d=o('[data-cart="cart-item-title"]',c);d&&(d.textContent=r.name);let F=o('[data-cart="cart-item-desc"]',c);F&&(F.textContent=`${Object.keys(r.biomarkers).length} Biomarker`);let v=o('[data-cart="cart-item-price"]',c);v&&(v.textContent=S((l==null?void 0:l.final)||r.basePrice));let x=o('[data-cart="cart-item-remove"]',c)||o('[class*="remove"], [class*="trash"], [class*="delete"], .cart_modal-list_item-remove',c);x&&(x.style.cursor="pointer",x.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),H(n.sku)})),i("Rendered item:",n.sku,"title:",d==null?void 0:d.textContent,"price:",v==null?void 0:v.textContent,"img:",!!m,"trash:",!!x),h.appendChild(c)});let s=o(".cart_modal-price_wrap .heading-style-h4",e);s&&(s.textContent=S(a.total)),k("[data-cart-count]").forEach(n=>{n.textContent=t.length}),i("Cart modal render complete")}function H(e){let t=f().filter(a=>a.sku!==e);A(t),_(),w("Paket entfernt","info"),i("Removed from cart:",e)}function T(e,t){let a=f();if(!a.find(s=>s.sku===e)){let s={sku:e,addedAt:Date.now()};t&&(s.image=t),a.push(s),A(a),w("Paket hinzugef\xFCgt","success")}y()}function w(e,t="info"){if(window.Notification&&typeof window.Notification.show=="function"){window.Notification.show(e,t);return}let a=document.createElement("div");a.style.cssText=`position:fixed;top:20px;right:20px;padding:16px 24px;background:${t==="success"?"#00a86b":t==="error"?"#dc3545":"#333"};color:white;border-radius:8px;z-index:10001;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.15);transition:opacity 0.3s;`,a.textContent=e,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>a.remove(),300)},3e3)}function I(){let e=C();if(!e){i("Cart modal not found, skipping setup");return}e.style.display="none",e.style.opacity="0";let t=o(".cart_moda-box_close-button",e);t&&(t.style.cursor="pointer",t.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),E()}),i("Close button initialized"));let a=o(".cart_modal-bg",e);a&&(a.style.cursor="pointer",a.addEventListener("click",r=>{r.preventDefault(),E()}),i("Background click handler initialized"));let s=o(".button.is-link.is-secondary",e);s&&(s.style.cursor="pointer",s.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),D(),_(),w("Warenkorb geleert","info")}),i("Clear cart button initialized"));let n=o(".cart_modal-list_item-button_wrap .button:not(.is-secondary)",e);n&&(n.addEventListener("click",r=>{if(r.preventDefault(),r.stopPropagation(),f().length===0){w("Warenkorb ist leer","error");return}window.location.href=b.CHECKOUT_URL}),i("Checkout button initialized")),document.addEventListener("keydown",r=>{r.key==="Escape"&&e.style.display!=="none"&&E()}),i("Cart modal setup complete")}function N(){let e=k('[data-cart-trigger], [data-cart="open"], .cart-icon, .cart-trigger, [href="#cart"]');e.forEach(t=>{t.style.cursor="pointer",t.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),y()})}),i("Cart triggers initialized:",e.length),document.addEventListener("click",t=>{t.target.closest("[data-cart-trigger], [data-open-cart]")&&(t.preventDefault(),t.stopPropagation(),y())}),document.addEventListener("click",t=>{let a=t.target.closest('[data-packages="btn-buy"]');if(!a)return;t.preventDefault(),t.stopPropagation();let s=a.closest("[data-package-sku]"),n=s?s.getAttribute("data-package-sku"):null;if(n||(n=a.getAttribute("data-package-sku")),!n){let m=window.location.pathname.replace(/\/$/,"").split("/").pop();n=L[m]}if(!n||!u[n]){i("Buy button clicked but no valid SKU found");return}let r=u[n],l=s?s.querySelector('[data-packages="img"]')||s.querySelector("img"):document.querySelector("section img.cover-img, .b-test_head img.cover-img, img"),c=l?l.src:"";i("Global buy button clicked:",n,c),T(n,c)})}function z(){let e=f();k("[data-cart-count]").forEach(t=>{t.textContent=e.length})}function O(){let t=window.location.pathname.replace(/\/$/,"").split("/").pop(),a=L[t];if(!a){i("Not a package page or unknown slug:",t);return}if(!u[a]){i("Package not found for SKU:",a);return}i("Package page detected:",t,"-> SKU:",a),k('[data-cart="add-to-cart"], [data-add-to-cart], [data-hero="item"]').forEach(r=>{r.textContent.toLowerCase().includes("warenkorb")&&(i("Found add-to-cart button:",r),r.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation();let m=o("section img.cover-img, .b-test_head img.cover-img"),d=m?m.src:"";i("Add to cart clicked for package:",a,"image:",d),T(a,d)}))})}function M(){i("Initializing global cart modal"),I(),N(),O(),z(),window.addEventListener("cart-updated",()=>{_(),z()}),window.CartModal={open:y,close:E,render:_,getItems:f,clear:D,add:T,remove:H,calculate:B,PACKAGES:u},i("Global cart modal ready. Use CartModal.open() to open.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M):M()})();})();
