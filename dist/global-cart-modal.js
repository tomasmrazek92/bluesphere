"use strict";(()=>{(function(){let h={DEBUG:!0,CART_KEY:"wf_cart_v3",CHECKOUT_URL:"/deine-bestellung"},E={"package-mens-health":"mens_health","package-womens-health":"womens_health","package-chronic-inflammation":"chronic_inflammation","package-eisenmetabolismus":"iron_metabolism","package-heart-health":"heart_health","package-vitamin-b-stoffwechsel":"vitamin_b_metabolism","package-vitamin-d":"vitamin_d","longterm-health":"longterm_health"},m={mens_health:{name:"M\xE4nnergesundheit",basePrice:8743,image:"",biomarkers:{lh:{name:"LH",price:1457},fsh:{name:"FSH",price:1457},prolactin:{name:"Prolaktin",price:1e3},estradiol:{name:"Estradiol",price:1360},dheas:{name:"DHEAS",price:1360},shbg:{name:"SHBG",price:1749},testosterone:{name:"Testosterone",price:1360},free_testosterone_index:{name:"Free Testosterone Index",price:1e3}}},womens_health:{name:"Frauengesundheit",basePrice:12143,image:"",biomarkers:{progesterone:{name:"Progesterone",price:1360},estradiol:{name:"Estradiol",price:1360},fsh:{name:"FSH",price:1457},lh:{name:"LH",price:1457},dheas:{name:"DHEAS",price:1360},shbg:{name:"SHBG",price:1749},testosterone:{name:"Testosterone",price:1360},free_testosterone_index:{name:"Free Testosterone Index",price:1e3},ferritin:{name:"Ferritin",price:1457},transferrin:{name:"Transferrin",price:583}}},chronic_inflammation:{name:"Chronische Entz\xFCndung",basePrice:3332,image:"",biomarkers:{hscrp:{name:"hsC-reaktive Protein",price:1166},neutrophile_granulozyten:{name:"Neutrophile Granulozyten",price:1166},interleukin_6:{name:"Interleukin-6",price:1e3}}},iron_metabolism:{name:"Eisen-Metabolismus",basePrice:2873,image:"",biomarkers:{ferritin:{name:"Ferritin",price:1457},transferrin:{name:"Transferrin",price:583},eisen:{name:"Eisen",price:233},transferrin_saettigung:{name:"Transferrin-S\xE4ttigung",price:600}}},heart_health:{name:"Herzgesundheit",basePrice:4498,image:"",biomarkers:{apo_b:{name:"APO B",price:2332},hscrp:{name:"hsC-reaktive Protein",price:1166},lpa:{name:"Lp(a)",price:1e3}}},vitamin_b_metabolism:{name:"Vitamin B Stoffwechsel",basePrice:9236,image:"",biomarkers:{vitamin_b2:{name:"Vitamin B2",price:3322},vitamin_b12:{name:"Vitamin B12",price:1457},vitamin_b9:{name:"Vitamin B9 (Fols\xE4ure)",price:1457},vitamin_b6:{name:"Vitamin B6",price:3322}}},vitamin_d:{name:"Vitamin D",basePrice:1865,image:"",biomarkers:{vitamin_d_25oh:{name:"Vitamin D 25OH",price:1865}}},longterm_health:{name:"Longterm Health",basePrice:3964,image:"",biomarkers:{hba1c:{name:"HbA1C",price:1166},crp:{name:"CRP",price:1166},alat:{name:"ALAT",price:233},cystatin_c:{name:"Cystatin C",price:1166},ldl:{name:"LDL",price:233}}}},r=(...t)=>h.DEBUG&&console.log("[CART-MODAL]",...t),l=(t,e=document)=>e.querySelector(t),u=(t,e=document)=>[...e.querySelectorAll(t)],P=t=>new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t/100),g=()=>{try{return JSON.parse(localStorage.getItem(h.CART_KEY)||"[]")}catch{return[]}},S=t=>{localStorage.setItem(h.CART_KEY,JSON.stringify(t)),window.dispatchEvent(new CustomEvent("cart-updated"))},T=()=>{localStorage.removeItem(h.CART_KEY),window.dispatchEvent(new CustomEvent("cart-updated"))};function L(t){let e=new Map,a=0,n=0,o=[];return t.forEach(i=>{let s=m[i.sku];if(!s)return;let c=s.basePrice;Object.entries(s.biomarkers).forEach(([d,p])=>{e.has(d)?(c-=p.price,n+=p.price):e.set(d,s.name)}),o.push({sku:i.sku,name:s.name,original:s.basePrice,final:c}),a+=c}),{total:a,deductions:n,prices:o,original:t.reduce((i,s)=>{var c;return i+(((c=m[s.sku])==null?void 0:c.basePrice)||0)},0)}}let w=null;function b(){return w||(w=l(".cart-modal")),w}function k(){let t=b();if(!t){r("Cart modal not found in DOM");return}t.style.display="flex",setTimeout(()=>{t.style.opacity="1";let e=l(".cart_modal-box",t);e&&(e.style.opacity="1",e.style.transform="translate3d(0rem, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg)")},10),v(),r("Cart modal opened")}function _(){let t=b();if(!t)return;let e=l(".cart_modal-box",t);e&&(e.style.opacity="0",e.style.transform="translate3d(2rem, 0px, 0px) scale3d(1, 1, 1) rotateX(0deg) rotateY(0deg) rotateZ(0deg) skew(0deg, 0deg)"),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>{t.style.display="none"},200)},100),r("Cart modal closed")}function v(){let t=b();if(!t)return;let e=g(),a=L(e);r("Rendering cart modal:",e.length,"items");let n=l(".cart_modal-list",t);if(!n){r("List container not found");return}if(u(".cart_modal-list_item",n).forEach(i=>i.remove()),e.length===0){let i=document.createElement("li");i.className="cart_modal-list_item",i.innerHTML='<div class="cart_modal-list_item-inner" style="justify-content: center; padding: 2rem;"><div class="text-color-gray-70"><div class="text-size-small">Warenkorb ist leer</div></div></div>',n.appendChild(i)}else e.forEach(i=>{let s=m[i.sku];if(!s)return;let c=a.prices.find(y=>y.sku===i.sku),d=i.image||s.image||"",p=P((c==null?void 0:c.final)||s.basePrice),N=Object.keys(s.biomarkers).length,f=document.createElement("li");f.className="cart_modal-list_item",f.setAttribute("data-cart","cart-item"),f.setAttribute("data-sku",i.sku),f.innerHTML=`
          <div class="cart_modal-list_item-inner">
            <div class="cart_modal-list_item-box">
              <div class="cart_modal-list_item_visual">
                <img class="cover-img" data-cart="cart-item-img" alt="${s.name}" loading="lazy" src="${d}">
              </div>
            </div>
            <div class="cart_modal-list_item-text_wrap">
              <div class="text-weight-medium">
                <div data-cart="cart-item-title" class="text-size-regular">${s.name}</div>
              </div>
              <div class="text-color-gray-70">
                <div data-cart="cart-item-desc" class="text-size-small _1percent_letter-spacing">${N} Biomarker</div>
              </div>
            </div>
          </div>
          <div class="cart_modal-list_item-text_wrap is-2">
            <div class="text-weight-medium">
              <div class="cart_modal-list_item-price-wrap">
                <div data-cart="cart-item-price" class="text-size-regular">${p}</div>
                <div data-cart="cart-item-price-unit" class="text-size-regular">\u20AC</div>
              </div>
            </div>
            <div data-cart="cart-item-remove" class="cart_modal-list_item-trash" style="cursor:pointer;">
              <div class="icon-embed-xxsmall w-embed"><svg width="100%" height="100%" viewBox="0 0 15 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10.0139 4.8V4.24C10.0139 3.45593 10.0139 3.06389 9.85644 2.76441C9.71799 2.50098 9.49699 2.28681 9.22522 2.15259C8.91626 2 8.51174 2 7.70278 2H6.54722C5.73826 2 5.33377 2 5.02479 2.15259C4.753 2.28681 4.53203 2.50098 4.39355 2.76441C4.23611 3.06389 4.23611 3.45593 4.23611 4.24V4.8M5.68056 8.65V12.15M8.56944 8.65V12.15M0.625 4.8H13.625M12.1806 4.8V12.64C12.1806 13.8161 12.1806 14.4041 11.9444 14.8534C11.7367 15.2485 11.4052 15.5698 10.9976 15.7711C10.534 16 9.92737 16 8.71389 16H5.53611C4.32266 16 3.71594 16 3.25247 15.7711C2.84478 15.5698 2.51332 15.2485 2.3056 14.8534C2.06944 14.4041 2.06944 13.8161 2.06944 12.64V4.8" stroke="currentColor" stroke-width="1.25" stroke-linecap="round" stroke-linejoin="round"></path>
              </svg></div>
            </div>
          </div>`;let z=l('[data-cart="cart-item-remove"]',f);z&&z.addEventListener("click",y=>{y.preventDefault(),y.stopPropagation(),B(i.sku)}),r("Rendered item:",i.sku,s.name),n.appendChild(f)});let o=l('[data-cart="total-price"]',t)||l(".cart_modal-price_wrap .heading-style-h4",t);o&&(o.textContent=P(a.total)),u("[data-cart-count]").forEach(i=>{i.textContent=e.length}),r("Cart modal render complete")}function B(t){let e=g().filter(a=>a.sku!==t);S(e),v(),C("Paket entfernt","info"),r("Removed from cart:",t)}function x(t,e){let a=g();if(!a.find(n=>n.sku===t)){let n={sku:t,addedAt:Date.now()};e&&(n.image=e),a.push(n),S(a),C("Paket hinzugef\xFCgt","success")}k()}function C(t,e="info"){var o;if(window.Notification&&typeof window.Notification.show=="function"){window.Notification.show(t,e);return}let a=((o=document.querySelector(".navbar"))==null?void 0:o.getBoundingClientRect().bottom)||80,n=document.createElement("div");n.style.cssText=`position:fixed;top:${a+8}px;right:20px;padding:16px 24px;background:${e==="success"?"#00a86b":e==="error"?"#dc3545":"#333"};color:white;border-radius:8px;z-index:10001;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.15);transition:opacity 0.3s;`,n.textContent=t,document.body.appendChild(n),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>n.remove(),300)},3e3)}function M(){let t=b();if(!t){r("Cart modal not found, skipping setup");return}t.style.display="none",t.style.opacity="0";let e=l(".cart_moda-box_close-button",t);e&&(e.style.cursor="pointer",e.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),_()}),r("Close button initialized"));let a=l(".cart_modal-bg",t);a&&(a.style.cursor="pointer",a.addEventListener("click",i=>{i.preventDefault(),_()}),r("Background click handler initialized"));let n=l(".button.is-link.is-secondary",t);n&&(n.style.cursor="pointer",n.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),T(),v(),C("Warenkorb geleert","info")}),r("Clear cart button initialized"));let o=l(".cart_modal-list_item-button_wrap .button:not(.is-secondary)",t);o&&(o.addEventListener("click",i=>{if(i.preventDefault(),i.stopPropagation(),g().length===0){C("Warenkorb ist leer","error");return}window.location.href=h.CHECKOUT_URL}),r("Checkout button initialized")),document.addEventListener("keydown",i=>{i.key==="Escape"&&t.style.display!=="none"&&_()}),r("Cart modal setup complete")}function H(){let t=u('[data-cart-trigger], [data-cart="open"], .cart-icon, .cart-trigger, .nav_cart, [href="#cart"]');t.forEach(e=>{e.style.cursor="pointer",e.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),k()})}),r("Cart triggers initialized:",t.length),document.addEventListener("click",e=>{e.target.closest("[data-cart-trigger], [data-open-cart], .nav_cart")&&(e.preventDefault(),e.stopPropagation(),k())}),document.addEventListener("click",e=>{let a=e.target.closest('[data-packages="btn-buy"]');if(!a)return;e.preventDefault(),e.stopPropagation();let n=a.closest("[data-package-sku]"),o=n?n.getAttribute("data-package-sku"):null;if(o||(o=a.getAttribute("data-package-sku")),!o){let d=window.location.pathname.replace(/\/$/,"").split("/").pop();o=E[d]}if(!o||!m[o]){r("Buy button clicked but no valid SKU found");return}let i=m[o],s=n?n.querySelector('[data-packages="img"]')||n.querySelector("img"):document.querySelector("section img.cover-img, .b-test_head img.cover-img, img"),c=s?s.src:"";r("Global buy button clicked:",o,c),x(o,c)})}function A(){let t=g();u("[data-cart-count]").forEach(e=>{e.textContent=t.length}),u(".nav_cart").forEach(e=>{e.style.position="relative";let a=e.querySelector(".nav_cart-badge");a||(a=document.createElement("div"),a.className="nav_cart-badge",a.style.cssText="position:absolute;top:15px;right:15px;min-width:16px;height:16px;background:#245bec;color:#fff;border-radius:50%;font-size:10px;font-weight:600;display:flex;align-items:center;justify-content:center;line-height:1;padding:0 3px;pointer-events:none;",e.appendChild(a)),t.length>0?(a.textContent=t.length,a.style.display="flex"):a.style.display="none"})}function F(){let e=window.location.pathname.replace(/\/$/,"").split("/").pop(),a=E[e];if(!a){r("Not a package page or unknown slug:",e);return}if(!m[a]){r("Package not found for SKU:",a);return}r("Package page detected:",e,"-> SKU:",a),u('[data-cart="add-to-cart"], [data-add-to-cart], [data-hero="item"]').forEach(i=>{i.textContent.toLowerCase().includes("warenkorb")&&(r("Found add-to-cart button:",i),i.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation();let d=l("section img.cover-img, .b-test_head img.cover-img"),p=d?d.src:"";r("Add to cart clicked for package:",a,"image:",p),x(a,p)}))})}function D(){r("Initializing global cart modal"),M(),H(),F(),A(),window.addEventListener("cart-updated",()=>{v(),A()}),window.CartModal={open:k,close:_,render:v,getItems:g,clear:T,add:x,remove:B,calculate:L,PACKAGES:m},r("Global cart modal ready. Use CartModal.open() to open.")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",D):D()})();})();
