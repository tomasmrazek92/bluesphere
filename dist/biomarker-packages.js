"use strict";(()=>{(function(){let b={DEBUG:!0,PACKAGE_IDS:{longterm_health:1001,womens_health:1002,mens_health:1003,chronic_inflammation:1004,iron_metabolism:1005,heart_health:1006,vitamin_b_metabolism:1007,vitamin_d:1008}},i={log:(...e)=>b.DEBUG&&console.log("[PACKAGES]",...e),error:(...e)=>console.error("[PACKAGES]",...e)},F=(e,t=document)=>t.querySelector(e),S=(e,t=document)=>[...t.querySelectorAll(e)],v=(e,t="eur")=>new Intl.NumberFormat("de-DE",{style:"currency",currency:t}).format(e/100),y=e=>new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e/100),h=["mens_health","womens_health","longterm_health","iron_metabolism","vitamin_b_metabolism","vitamin_d"];function A(){return window.CartModal&&window.CartModal.PACKAGES?window.CartModal.PACKAGES:(i.error("CartModal.PACKAGES not available - make sure global-cart-modal.js is loaded first"),{})}function f(e,t="info"){let a=document.createElement("div");a.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      background: ${t==="success"?"#00a86b":t==="error"?"#dc3545":"#333"};
      color: white;
      border-radius: 8px;
      z-index: 10000;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: opacity 0.3s ease;
    `,a.innerHTML=e,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>a.remove(),300)},4e3)}function q(e,t=!1){if(i.log("Adding item to cart:",e),!window.CartModal){i.error("CartModal not available");return}let a=window.CartModal.getItems();if(a.some(u=>u.sku===e.sku)){f("Dieses Paket ist bereits im Warenkorb","info"),t?window.location.href="/deine-bestellung":window.CartModal.open();return}let o=[...a,{sku:e.sku}],n=window.CartModal.calculate(o),c=window.CartModal.calculate(a),l=n.deductions-c.deductions;window.CartModal.add(e.sku),l>0&&f(`Paket hinzugef\xFCgt! Sie sparen ${v(l)} durch bereits enthaltene Biomarker.`,"success"),t&&setTimeout(()=>{window.location.href="/deine-bestellung"},500)}function B(){let e=S('[data-packages="title"]'),t=[];return e.forEach(a=>{let r=a.parentElement;for(;r&&!r.classList.contains("w-dyn-item")&&r.tagName!=="SECTION";){let o=r.querySelector('[data-packages="img"], [data-packages=" img"]'),n=r.querySelector('[data-packages="price"]'),c=r.querySelector('[data-packages="list-item-title"]');if(o&&n&&c){t.includes(r)||t.push(r);break}r=r.parentElement}}),i.log(`Found ${t.length} package cards`),t}function D(){i.log("Rendering package cards...");let e=A(),t=B();if(t.length===0){i.error("No package cards found on the page!");return}t.length!==h.length&&i.log(`Warning: Found ${t.length} cards but expected ${h.length}`),t.forEach((a,r)=>{let o=h[r];if(!o){i.error(`No package SKU defined for card index ${r}`);return}let n=e[o];if(!n){i.error(`Package data not found for SKU: ${o}`);return}i.log(`Rendering card ${r}: ${o} (${n.name})`),a.setAttribute("data-package-sku",o);let c=a.querySelector('[data-packages="img"], [data-packages=" img"]');c&&n.image&&(c.src=n.image,c.alt=n.name);let l=a.querySelector('[data-packages="title"]');l&&(l.textContent=n.name);let u=a.querySelector('[data-packages="desc"]');u&&n.description&&(u.textContent=n.description);let d=a.querySelector('[data-packages="price"]');d&&(d.textContent=y(n.basePrice)),N(a,n),G(a,o,n)})}function N(e,t){let a=e.querySelectorAll('[data-packages="list-item-title"]'),r=e.querySelectorAll('[data-packages="list-item-price"]'),o=Object.entries(t.biomarkers);a.forEach((n,c)=>{if(c<o.length){let[l,u]=o[c];n.textContent=u.name,r[c]&&(r[c].textContent=v(u.price));let d=n.closest('[data-packages="list-item"]')||n.parentElement;d&&(d.style.display="")}else{let l=n.closest('[data-packages="list-item"]')||n.parentElement;l&&(l.style.display="none")}})}function G(e,t,a){let r=e.querySelector('[data-packages="btn-buy"]');if(r)i.log(`Card ${t}: Found buy button [data-packages="btn-buy"]`),r.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),i.log("Buy button clicked for:",t);let n={sku:t,name:a.name,price:a.basePrice,currency:"eur",image:a.image,priceId:b.PACKAGE_IDS[t]||t,qty:1};q(n,!1)});else{let o=e.querySelector('.is-cart, [class*="cart"]');o?(i.log(`Card ${t}: Found cart button by class`),o.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation(),i.log("Cart button clicked for:",t);let c={sku:t,name:a.name,price:a.basePrice,currency:"eur",image:a.image,priceId:b.PACKAGE_IDS[t]||t,qty:1};q(c,!1)})):i.log(`Card ${t}: No buy button found!`)}}let p=null,g=null;function L(){let e=document.querySelector('[data-cart="cart-item-title"]');if(!e)return i.log("No cart item title found - cart template not available"),!1;let t=e.parentElement;for(;t;){let a=t.querySelector('[data-cart="cart-item-img"]'),r=t.querySelector('[data-cart="cart-item-price"]');if(a&&r)return p=t.cloneNode(!0),g=t.parentElement,t.setAttribute("data-cart-template","original"),i.log("Cart item template found and saved"),!0;t=t.parentElement}return i.log("Could not find cart item template container"),!1}function w(){if(!window.CartModal)return;let e=A(),t=window.CartModal.getItems(),a=window.CartModal.calculate(t),r=document.querySelector('[data-cart="total-price"]'),o=document.querySelector('[data-cart="total-price-unit"]');if(p||L(),p&&g){g.querySelectorAll("[data-cart-cloned]").forEach(l=>l.remove());let c=g.querySelector('[data-cart-template="original"]');c&&(c.style.display=t.length===0?"none":""),t.forEach((l,u)=>{let d=e[l.sku];if(!d)return;let P=a.prices.find(m=>m.sku===l.sku),s;u===0&&c?(s=c,s.style.display=""):(s=p.cloneNode(!0),s.setAttribute("data-cart-cloned","true"),s.removeAttribute("data-cart-template"),g.appendChild(s)),s.setAttribute("data-sku",l.sku);let E=s.querySelector('[data-cart="cart-item-img"]');E&&(E.src=l.image||d.image,E.alt=l.name||d.name);let I=s.querySelector('[data-cart="cart-item-title"]');I&&(I.textContent=l.name||d.name);let x=s.querySelector('[data-cart="cart-item-desc"]');if(x){let m=Object.keys(d.biomarkers).length;x.textContent=`${m} Biomarker`}let M=s.querySelector('[data-cart="cart-item-price"]');if(M){let m=P?P.final:d.basePrice;M.textContent=y(m)}let _=s.querySelector('[data-cart="cart-item-price-unit"]');_&&(_.textContent="\u20AC");let C=s.querySelector('[data-cart="remove-item"]')||s.querySelector("button")||s.querySelector('[class*="remove"]');if(C){let m=C.cloneNode(!0);C.parentNode.replaceChild(m,C),m.addEventListener("click",$=>{$.preventDefault(),$.stopPropagation(),window.CartModal.remove(l.sku)})}})}r&&(r.textContent=y(a.total)),o&&(o.textContent="\u20AC"),S("[data-cart-count]").forEach(n=>{n.textContent=t.length}),i.log("Cart UI rendered:",{itemCount:t.length,total:a.total,deductions:a.deductions})}function K(){let e=document.querySelector('[data-cart="wrap"]'),t=document.querySelector('[data-cart="toggle"]');t&&e&&t.addEventListener("click",o=>{o.preventDefault();let n=e.getAttribute("data-modal-status")==="active";e.setAttribute("data-modal-status",n?"not-active":"active"),n||w()});let a=document.querySelector('[data-cart="close"]');a&&e&&a.addEventListener("click",o=>{o.preventDefault(),e.setAttribute("data-modal-status","not-active")});let r=document.querySelector('[data-cart="cart-empty"]');r&&r.addEventListener("click",o=>{o.preventDefault(),window.CartModal&&window.CartModal.clear(),f("Warenkorb wurde geleert","info")}),i.log("Cart controls setup complete")}function T(){document.addEventListener("click",e=>{var r;if(!((r=e.target)==null?void 0:r.closest('[data-cart="btn-buy"], #wf-checkout, [data-cart="checkout"]'))||(i.log("Checkout button clicked - redirecting to order page"),e.preventDefault(),e.stopPropagation(),!window.CartModal))return;if(window.CartModal.getItems().length===0){f("Warenkorb ist leer.","error");return}window.location.href="/deine-bestellung"},!0)}function k(){if(i.log("=== Biomarker package page initializing ==="),!window.CartModal){i.log("Waiting for CartModal..."),setTimeout(k,100);return}D(),w(),K(),T(),window.addEventListener("cart-updated",()=>{w()}),i.log("=== Biomarker package page initialized ===")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k()})();})();
