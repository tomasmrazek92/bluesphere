"use strict";(()=>{(function(){let b={DEBUG:!0,PACKAGE_IDS:{longterm_health:1001,womens_health:1002,mens_health:1003,chronic_inflammation:1004,iron_metabolism:1005,heart_health:1006,vitamin_b_metabolism:1007,vitamin_d:1008}},i={log:(...e)=>b.DEBUG&&console.log("[PACKAGES]",...e),error:(...e)=>console.error("[PACKAGES]",...e)},z=(e,t=document)=>t.querySelector(e),A=(e,t=document)=>[...t.querySelectorAll(e)],q=(e,t="eur")=>new Intl.NumberFormat("de-DE",{style:"currency",currency:t}).format(e/100),y=e=>new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e/100),k=["mens_health","womens_health","longterm_health","iron_metabolism","vitamin_b_metabolism","vitamin_d"];function v(){return window.CartModal&&window.CartModal.PACKAGES?window.CartModal.PACKAGES:(i.error("CartModal.PACKAGES not available - make sure global-cart-modal.js is loaded first"),{})}function f(e,t="info"){let a=document.createElement("div");a.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      background: ${t==="success"?"#00a86b":t==="error"?"#dc3545":"#333"};
      color: white;
      border-radius: 8px;
      z-index: 10000;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: opacity 0.3s ease;
    `,a.innerHTML=e,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>a.remove(),300)},4e3)}function P(e,t=!1){if(i.log("Adding item to cart:",e),!window.CartModal){i.error("CartModal not available");return}let a=window.CartModal.getItems();if(a.some(u=>u.sku===e.sku)){f("Dieses Paket ist bereits im Warenkorb","info"),t?window.location.href="/deine-bestellung":window.CartModal.open();return}let o=[...a,{sku:e.sku}],r=window.CartModal.calculate(o),c=window.CartModal.calculate(a),l=r.deductions-c.deductions;window.CartModal.add(e.sku,e.image),l>0&&f(`Paket hinzugef\xFCgt! Sie sparen ${q(l)} durch bereits enthaltene Biomarker.`,"success"),t&&setTimeout(()=>{window.location.href="/deine-bestellung"},500)}function B(){let e=A('[data-packages="title"]'),t=[];return e.forEach(a=>{let n=a.parentElement;for(;n&&!n.classList.contains("w-dyn-item")&&n.tagName!=="SECTION";){let o=n.querySelector('[data-packages="img"], [data-packages=" img"]'),r=n.querySelector('[data-packages="price"]'),c=n.querySelector('[data-packages="list-item-title"]');if(o&&r&&c){t.includes(n)||t.push(n);break}n=n.parentElement}}),i.log(`Found ${t.length} package cards`),t}function T(){i.log("Rendering package cards...");let e=v(),t=B();if(t.length===0){i.error("No package cards found on the page!");return}t.length!==k.length&&i.log(`Warning: Found ${t.length} cards but expected ${k.length}`),t.forEach((a,n)=>{let o=k[n];if(!o){i.error(`No package SKU defined for card index ${n}`);return}let r=e[o];if(!r){i.error(`Package data not found for SKU: ${o}`);return}i.log(`Rendering card ${n}: ${o} (${r.name})`),a.setAttribute("data-package-sku",o);let c=a.querySelector('[data-packages="img"], [data-packages=" img"]');c&&r.image&&(c.src=r.image,c.alt=r.name);let l=a.querySelector('[data-packages="title"]');l&&(l.textContent=r.name);let u=a.querySelector('[data-packages="desc"]');u&&r.description&&(u.textContent=r.description);let d=a.querySelector('[data-packages="price"]');d&&(d.textContent=y(r.basePrice)),N(a,r),G(a,o,r)})}function N(e,t){let a=e.querySelectorAll('[data-packages="list-item-title"]'),n=e.querySelectorAll('[data-packages="list-item-price"]'),o=Object.entries(t.biomarkers);a.forEach((r,c)=>{if(c<o.length){let[l,u]=o[c];r.textContent=u.name,n[c]&&(n[c].textContent=q(u.price));let d=r.closest('[data-packages="list-item"]')||r.parentElement;d&&(d.style.display="")}else{let l=r.closest('[data-packages="list-item"]')||r.parentElement;l&&(l.style.display="none")}})}function G(e,t,a){let n=e.querySelector('[data-packages="btn-buy"]');if(n)i.log(`Card ${t}: Found buy button [data-packages="btn-buy"]`),n.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),i.log("Buy button clicked for:",t);let r=e.querySelector('[data-packages="img"], [data-packages=" img"]'),c={sku:t,name:a.name,price:a.basePrice,currency:"eur",image:r?r.src:"",priceId:b.PACKAGE_IDS[t]||t,qty:1};P(c,!1)});else{let o=e.querySelector('.is-cart, [class*="cart"]');o?(i.log(`Card ${t}: Found cart button by class`),o.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),i.log("Cart button clicked for:",t);let c=e.querySelector('[data-packages="img"], [data-packages=" img"]'),l={sku:t,name:a.name,price:a.basePrice,currency:"eur",image:c?c.src:"",priceId:b.PACKAGE_IDS[t]||t,qty:1};P(l,!1)})):i.log(`Card ${t}: No buy button found!`)}}let p=null,g=null;function L(){let e=document.querySelector('[data-cart="cart-item-title"]');if(!e)return i.log("No cart item title found - cart template not available"),!1;let t=e.parentElement;for(;t;){let a=t.querySelector('[data-cart="cart-item-img"]'),n=t.querySelector('[data-cart="cart-item-price"]');if(a&&n)return p=t.cloneNode(!0),g=t.parentElement,t.setAttribute("data-cart-template","original"),i.log("Cart item template found and saved"),!0;t=t.parentElement}return i.log("Could not find cart item template container"),!1}function h(){if(!window.CartModal)return;let e=v(),t=window.CartModal.getItems(),a=window.CartModal.calculate(t),n=document.querySelector('[data-cart="total-price"]'),o=document.querySelector('[data-cart="total-price-unit"]');if(p||L(),p&&g){g.querySelectorAll("[data-cart-cloned]").forEach(l=>l.remove());let c=g.querySelector('[data-cart-template="original"]');c&&(c.style.display=t.length===0?"none":""),t.forEach((l,u)=>{let d=e[l.sku];if(!d)return;let I=a.prices.find(m=>m.sku===l.sku),s;u===0&&c?(s=c,s.style.display=""):(s=p.cloneNode(!0),s.setAttribute("data-cart-cloned","true"),s.removeAttribute("data-cart-template"),g.appendChild(s)),s.setAttribute("data-sku",l.sku);let S=s.querySelector('[data-cart="cart-item-img"]');S&&(S.src=l.image||d.image,S.alt=l.name||d.name);let M=s.querySelector('[data-cart="cart-item-title"]');M&&(M.textContent=l.name||d.name);let x=s.querySelector('[data-cart="cart-item-desc"]');if(x){let m=Object.keys(d.biomarkers).length;x.textContent=`${m} Biomarker`}let _=s.querySelector('[data-cart="cart-item-price"]');if(_){let m=I?I.final:d.basePrice;_.textContent=y(m)}let D=s.querySelector('[data-cart="cart-item-price-unit"]');D&&(D.textContent="\u20AC");let C=s.querySelector('[data-cart="remove-item"]')||s.querySelector("button")||s.querySelector('[class*="remove"]');if(C){let m=C.cloneNode(!0);C.parentNode.replaceChild(m,C),m.addEventListener("click",$=>{$.preventDefault(),$.stopPropagation(),window.CartModal.remove(l.sku)})}})}n&&(n.textContent=y(a.total)),o&&(o.textContent="\u20AC"),A("[data-cart-count]").forEach(r=>{r.textContent=t.length}),i.log("Cart UI rendered:",{itemCount:t.length,total:a.total,deductions:a.deductions})}function K(){let e=document.querySelector('[data-cart="wrap"]'),t=document.querySelector('[data-cart="toggle"]');t&&e&&t.addEventListener("click",o=>{o.preventDefault();let r=e.getAttribute("data-modal-status")==="active";e.setAttribute("data-modal-status",r?"not-active":"active"),r||h()});let a=document.querySelector('[data-cart="close"]');a&&e&&a.addEventListener("click",o=>{o.preventDefault(),e.setAttribute("data-modal-status","not-active")});let n=document.querySelector('[data-cart="cart-empty"]');n&&n.addEventListener("click",o=>{o.preventDefault(),window.CartModal&&window.CartModal.clear(),f("Warenkorb wurde geleert","info")}),i.log("Cart controls setup complete")}function F(){document.addEventListener("click",e=>{var n;if(!((n=e.target)==null?void 0:n.closest('[data-cart="btn-buy"], #wf-checkout, [data-cart="checkout"]'))||(i.log("Checkout button clicked - redirecting to order page"),e.preventDefault(),e.stopPropagation(),!window.CartModal))return;if(window.CartModal.getItems().length===0){f("Warenkorb ist leer.","error");return}window.location.href="/deine-bestellung"},!0)}let w=0,U=50;function E(){if(w++,!window.CartModal){if(w<=U){w===1&&i.log("Waiting for CartModal..."),setTimeout(E,100);return}i.error("CartModal not available after 5s - initializing without it")}i.log("=== Biomarker package page initializing ==="),T(),window.CartModal&&h(),K(),F(),window.addEventListener("cart-updated",()=>{h()}),i.log("=== Biomarker package page initialized ===")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",E):E()})();})();
