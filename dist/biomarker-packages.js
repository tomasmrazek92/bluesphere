"use strict";(()=>{(function(){let h={DEBUG:!0,PACKAGE_IDS:{longterm_health:1001,womens_health:1002,mens_health:1003,chronic_inflammation:1004,iron_metabolism:1005,heart_health:1006,vitamin_b_metabolism:1007,vitamin_d:1008}},o={log:(...e)=>h.DEBUG&&console.log("[PACKAGES]",...e),error:(...e)=>console.error("[PACKAGES]",...e)},O=(e,t=document)=>t.querySelector(e),q=(e,t=document)=>[...t.querySelectorAll(e)],v=(e,t="eur")=>new Intl.NumberFormat("de-DE",{style:"currency",currency:t}).format(e/100),y=e=>new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e/100),k=["longterm_health","womens_health","mens_health","chronic_inflammation","iron_metabolism","heart_health","vitamin_b_metabolism","vitamin_d"];function P(){return window.CartModal&&window.CartModal.PACKAGES?window.CartModal.PACKAGES:(o.error("CartModal.PACKAGES not available - make sure global-cart-modal.js is loaded first"),{})}function p(e,t="info"){let a=document.createElement("div");a.style.cssText=`
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 16px 24px;
      background: ${t==="success"?"#00a86b":t==="error"?"#dc3545":"#333"};
      color: white;
      border-radius: 8px;
      z-index: 10000;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: opacity 0.3s ease;
    `,a.innerHTML=e,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>a.remove(),300)},4e3)}function I(e,t=!1){if(o.log("Adding item to cart:",e),!window.CartModal){o.error("CartModal not available");return}let a=window.CartModal.getItems();if(a.some(m=>m.sku===e.sku)){p("Dieses Paket ist bereits im Warenkorb","info"),t?window.location.href="/deine-bestellung":window.CartModal.open();return}let i=[...a,{sku:e.sku}],r=window.CartModal.calculate(i),c=window.CartModal.calculate(a),l=r.deductions-c.deductions;window.CartModal.add(e.sku,e.image),l>0&&p(`Paket hinzugef\xFCgt! Sie sparen ${v(l)} durch bereits enthaltene Biomarker.`,"success"),t&&setTimeout(()=>{window.location.href="/deine-bestellung"},500)}function B(){let e=q('[data-packages="title"]'),t=[];return e.forEach(a=>{let n=a.parentElement;for(;n&&!n.classList.contains("w-dyn-item")&&n.tagName!=="SECTION";){let i=n.querySelector('[data-packages="img"], [data-packages=" img"]'),r=n.querySelector('[data-packages="price"]'),c=n.querySelector('[data-packages="list-item-title"]');if(i&&r&&c){t.includes(n)||t.push(n);break}n=n.parentElement}}),o.log(`Found ${t.length} package cards`),t}function T(){o.log("Rendering package cards...");let e=P(),t=B();if(t.length===0){o.error("No package cards found on the page!");return}t.length!==k.length&&o.log(`Warning: Found ${t.length} cards but expected ${k.length}`),t.forEach((a,n)=>{let i=k[n];if(!i){o.error(`No package SKU defined for card index ${n}`);return}let r=e[i];if(!r){o.error(`Package data not found for SKU: ${i}`);return}o.log(`Rendering card ${n}: ${i} (${r.name})`),a.setAttribute("data-package-sku",i);let c=a.querySelector('[data-packages="img"], [data-packages=" img"]');c&&r.image&&(c.src=r.image,c.alt=r.name);let l=a.querySelector('[data-packages="title"]');l&&(l.textContent=r.name);let m=a.querySelector('[data-packages="desc"]');m&&r.description&&(m.textContent=r.description);let d=a.querySelector('[data-packages="price"]');d&&(d.textContent=y(r.basePrice)),G(a,r),L(a,i,r)})}function G(e,t){let a=e.querySelectorAll('[data-packages="list-item-title"]'),n=e.querySelectorAll('[data-packages="list-item-price"]'),i=Object.entries(t.biomarkers);a.forEach((r,c)=>{if(c<i.length){let[l,m]=i[c];r.textContent=m.name,n[c]&&(n[c].textContent=v(m.price));let d=r.closest('[data-packages="list-item"]')||r.parentElement;d&&(d.style.display="")}else{let l=r.closest('[data-packages="list-item"]')||r.parentElement;l&&(l.style.display="none")}})}function L(e,t,a){let n=e.querySelector('[data-packages="btn-buy"]');if(n)o.log(`Card ${t}: Found buy button [data-packages="btn-buy"]`),n.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),o.log("Buy button clicked for:",t);let r=e.querySelector('[data-packages="img"], [data-packages=" img"]'),c={sku:t,name:a.name,price:a.basePrice,currency:"eur",image:r?r.src:"",priceId:h.PACKAGE_IDS[t]||t,qty:1};I(c,!1)});else{let i=e.querySelector('.is-cart, [class*="cart"]');i?(o.log(`Card ${t}: Found cart button by class`),i.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),o.log("Cart button clicked for:",t);let c=e.querySelector('[data-packages="img"], [data-packages=" img"]'),l={sku:t,name:a.name,price:a.basePrice,currency:"eur",image:c?c.src:"",priceId:h.PACKAGE_IDS[t]||t,qty:1};I(l,!1)})):o.log(`Card ${t}: No buy button found!`)}}let C=null,f=null;function K(){let e=document.querySelector('[data-cart="cart-item-title"]');if(!e)return o.log("No cart item title found - cart template not available"),!1;let t=e.parentElement;for(;t;){let a=t.querySelector('[data-cart="cart-item-img"]'),n=t.querySelector('[data-cart="cart-item-price"]');if(a&&n)return C=t.cloneNode(!0),f=t.parentElement,t.setAttribute("data-cart-template","original"),o.log("Cart item template found and saved"),!0;t=t.parentElement}return o.log("Could not find cart item template container"),!1}function w(){if(!window.CartModal)return;let e=P(),t=window.CartModal.getItems(),a=window.CartModal.calculate(t),n=document.querySelector('[data-cart="total-price"]'),i=document.querySelector('[data-cart="total-price-unit"]');if(C||K(),C&&f){f.querySelectorAll("[data-cart-cloned]").forEach(l=>l.remove());let c=f.querySelector('[data-cart-template="original"]');c&&(c.style.display=t.length===0?"none":""),t.forEach((l,m)=>{let d=e[l.sku];if(!d)return;let M=a.prices.find(u=>u.sku===l.sku),s;if(m===0&&c?(s=c,s.style.display=""):(s=C.cloneNode(!0),s.setAttribute("data-cart-cloned","true"),s.removeAttribute("data-cart-template"),f.appendChild(s)),s.setAttribute("data-sku",l.sku),m===0){let u=s.querySelectorAll("[data-cart]");o.log("Sidebar template data-cart elements:",u.length,[...u].map(g=>{var $;return{attr:g.getAttribute("data-cart"),tag:g.tagName,text:($=g.textContent)==null?void 0:$.substring(0,30)}}))}let A=s.querySelector('[data-cart="cart-item-img"]');A?(A.src=l.image||d.image,A.alt=l.name||d.name):o.log("No img element found in sidebar item");let x=s.querySelector('[data-cart="cart-item-title"]');x?x.textContent=l.name||d.name:o.log("No title element found in sidebar item");let _=s.querySelector('[data-cart="cart-item-desc"]');if(_){let u=Object.keys(d.biomarkers).length;_.textContent=`${u} Biomarker`}else o.log("No desc element found in sidebar item");let N=s.querySelector('[data-cart="cart-item-price"]');if(N){let u=M?M.final:d.basePrice;N.textContent=y(u)}else o.log("No price element found in sidebar item");let D=s.querySelector('[data-cart="cart-item-price-unit"]');D&&(D.textContent="\u20AC");let b=s.querySelector('[data-cart="remove-item"]')||s.querySelector("button")||s.querySelector('[class*="remove"]');if(b){let u=b.cloneNode(!0);b.parentNode.replaceChild(u,b),u.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),window.CartModal.remove(l.sku)})}})}n&&(n.textContent=y(a.total)),i&&(i.textContent="\u20AC"),q("[data-cart-count]").forEach(r=>{r.textContent=t.length}),o.log("Cart UI rendered:",{itemCount:t.length,total:a.total,deductions:a.deductions})}function F(){let e=document.querySelector('[data-cart="wrap"]'),t=document.querySelector('[data-cart="toggle"]');t&&e&&t.addEventListener("click",i=>{i.preventDefault();let r=e.getAttribute("data-modal-status")==="active";e.setAttribute("data-modal-status",r?"not-active":"active"),r||w()});let a=document.querySelector('[data-cart="close"]');a&&e&&a.addEventListener("click",i=>{i.preventDefault(),e.setAttribute("data-modal-status","not-active")});let n=document.querySelector('[data-cart="cart-empty"]');n&&n.addEventListener("click",i=>{i.preventDefault(),window.CartModal&&window.CartModal.clear(),p("Warenkorb wurde geleert","info")}),o.log("Cart controls setup complete")}function U(){document.addEventListener("click",e=>{var n;if(!((n=e.target)==null?void 0:n.closest('[data-cart="btn-buy"], #wf-checkout, [data-cart="checkout"]'))||(o.log("Checkout button clicked - redirecting to order page"),e.preventDefault(),e.stopPropagation(),!window.CartModal))return;if(window.CartModal.getItems().length===0){p("Warenkorb ist leer.","error");return}window.location.href="/deine-bestellung"},!0)}let E=0,z=50;function S(){if(E++,!window.CartModal){if(E<=z){E===1&&o.log("Waiting for CartModal..."),setTimeout(S,100);return}o.error("CartModal not available after 5s - initializing without it")}o.log("=== Biomarker package page initializing ==="),T(),window.CartModal&&w(),F(),U(),window.addEventListener("cart-updated",()=>{w()}),o.log("=== Biomarker package page initialized ===")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S()})();})();
