"use strict";(()=>{(function(){let h={DEBUG:!1,PACKAGE_IDS:{longterm_health:1001,womens_health:1002,mens_health:1003,chronic_inflammation:1004,iron_metabolism:1005,heart_health:1006,vitamin_b_metabolism:1007,vitamin_d:1008}},i={log:(...e)=>h.DEBUG&&console.log("[PACKAGES]",...e),error:(...e)=>console.error("[PACKAGES]",...e)},O=(e,t=document)=>t.querySelector(e),q=(e,t=document)=>[...t.querySelectorAll(e)],v=(e,t="eur")=>new Intl.NumberFormat("de-DE",{style:"currency",currency:t}).format(e/100),y=e=>new Intl.NumberFormat("de-DE",{minimumFractionDigits:2,maximumFractionDigits:2}).format(e/100),k=["longterm_health","womens_health","mens_health","chronic_inflammation","iron_metabolism","heart_health","vitamin_b_metabolism","vitamin_d"];function P(){return window.CartModal&&window.CartModal.PACKAGES?window.CartModal.PACKAGES:(i.error("CartModal.PACKAGES not available - make sure global-cart-modal.js is loaded first"),{})}function p(e,t="info"){var o;let n=((o=document.querySelector(".navbar"))==null?void 0:o.getBoundingClientRect().bottom)||80,a=document.createElement("div");a.style.cssText=`
      position: fixed;
      top: ${n+8}px;
      right: 20px;
      padding: 16px 24px;
      background: ${t==="success"?"#00a86b":t==="error"?"#dc3545":"#333"};
      color: white;
      border-radius: 8px;
      z-index: 10000;
      font-size: 14px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      transition: opacity 0.3s ease;
    `,a.innerHTML=e,document.body.appendChild(a),setTimeout(()=>{a.style.opacity="0",setTimeout(()=>a.remove(),300)},4e3)}function I(e,t=!1){if(i.log("Adding item to cart:",e),!window.CartModal){i.error("CartModal not available");return}let n=window.CartModal.getItems();if(n.some(m=>m.sku===e.sku)){p("Dieses Paket ist bereits im Warenkorb","info"),t?window.location.href="/deine-bestellung":window.CartModal.open();return}let o=[...n,{sku:e.sku}],r=window.CartModal.calculate(o),c=window.CartModal.calculate(n),l=r.deductions-c.deductions;window.CartModal.add(e.sku,e.image),l>0&&p(`Paket hinzugef\xFCgt! Sie sparen ${v(l)} durch bereits enthaltene Biomarker.`,"success"),t&&setTimeout(()=>{window.location.href="/deine-bestellung"},500)}function $(){let e=q('[data-packages="title"]'),t=[];return e.forEach(n=>{let a=n.parentElement;for(;a&&a.tagName!=="SECTION";){let o=a.querySelector('[data-packages="img"], [data-packages=" img"]'),r=a.querySelector('[data-packages="price"]'),c=a.querySelector('[data-packages="list-item-title"]');if(o&&r&&c){t.includes(a)||t.push(a);break}a=a.parentElement}}),i.log(`Found ${t.length} package cards`),t}function T(){i.log("Rendering package cards...");let e=P(),t=$();if(t.length===0){i.error("No package cards found on the page!");return}t.length!==k.length&&i.log(`Warning: Found ${t.length} cards but expected ${k.length}`),t.forEach((n,a)=>{let o=k[a];if(!o){i.error(`No package SKU defined for card index ${a}`);return}let r=e[o];if(!r){i.error(`Package data not found for SKU: ${o}`);return}i.log(`Rendering card ${a}: ${o} (${r.name})`),n.setAttribute("data-package-sku",o);let c=n.querySelector('[data-packages="img"], [data-packages=" img"]');c&&r.image&&(c.src=r.image,c.alt=r.name);let l=n.querySelector('[data-packages="title"]');l&&(l.textContent=r.name);let m=n.querySelector('[data-packages="desc"]');m&&r.description&&(m.textContent=r.description);let d=n.querySelector('[data-packages="price"]');d&&(d.textContent=y(r.basePrice)),G(n,r),K(n,o,r)})}function G(e,t){let n=e.querySelectorAll('[data-packages="list-item-title"]'),a=e.querySelectorAll('[data-packages="list-item-price"]'),o=Object.entries(t.biomarkers);n.forEach((r,c)=>{if(c<o.length){let[l,m]=o[c];r.textContent=m.name,a[c]&&(a[c].textContent=v(m.price));let d=r.closest('[data-packages="list-item"]')||r.parentElement;d&&(d.style.display="")}else{let l=r.closest('[data-packages="list-item"]')||r.parentElement;l&&(l.style.display="none")}})}function K(e,t,n){let a=e.querySelector('[data-packages="btn-buy"]');if(a)i.log(`Card ${t}: Found buy button [data-packages="btn-buy"]`),a.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),i.log("Buy button clicked for:",t);let r=e.querySelector('[data-packages="img"], [data-packages=" img"]'),c={sku:t,name:n.name,price:n.basePrice,currency:"eur",image:r?r.src:"",priceId:h.PACKAGE_IDS[t]||t,qty:1};I(c,!1)});else{let o=e.querySelector('.is-cart, [class*="cart"]');o?(i.log(`Card ${t}: Found cart button by class`),o.addEventListener("click",r=>{r.preventDefault(),r.stopPropagation(),i.log("Cart button clicked for:",t);let c=e.querySelector('[data-packages="img"], [data-packages=" img"]'),l={sku:t,name:n.name,price:n.basePrice,currency:"eur",image:c?c.src:"",priceId:h.PACKAGE_IDS[t]||t,qty:1};I(l,!1)})):i.log(`Card ${t}: No buy button found!`)}}let C=null,f=null;function L(){let e=document.querySelector('[data-cart="cart-item-title"]');if(!e)return i.log("No cart item title found - cart template not available"),!1;let t=e.parentElement;for(;t;){let n=t.querySelector('[data-cart="cart-item-img"]'),a=t.querySelector('[data-cart="cart-item-price"]');if(n&&a)return C=t.cloneNode(!0),f=t.parentElement,t.setAttribute("data-cart-template","original"),i.log("Cart item template found and saved"),!0;t=t.parentElement}return i.log("Could not find cart item template container"),!1}function w(){if(!window.CartModal)return;let e=P(),t=window.CartModal.getItems(),n=window.CartModal.calculate(t),a=document.querySelector('[data-cart="total-price"]'),o=document.querySelector('[data-cart="total-price-unit"]');if(C||L(),C&&f){f.querySelectorAll("[data-cart-cloned]").forEach(l=>l.remove());let c=f.querySelector('[data-cart-template="original"]');c&&(c.style.display=t.length===0?"none":""),t.forEach((l,m)=>{let d=e[l.sku];if(!d)return;let M=n.prices.find(u=>u.sku===l.sku),s;if(m===0&&c?(s=c,s.style.display=""):(s=C.cloneNode(!0),s.setAttribute("data-cart-cloned","true"),s.removeAttribute("data-cart-template"),f.appendChild(s)),s.setAttribute("data-sku",l.sku),m===0){let u=s.querySelectorAll("[data-cart]");i.log("Sidebar template data-cart elements:",u.length,[...u].map(g=>{var B;return{attr:g.getAttribute("data-cart"),tag:g.tagName,text:(B=g.textContent)==null?void 0:B.substring(0,30)}}))}let A=s.querySelector('[data-cart="cart-item-img"]');A?(A.src=l.image||d.image,A.alt=l.name||d.name):i.log("No img element found in sidebar item");let x=s.querySelector('[data-cart="cart-item-title"]');x?x.textContent=l.name||d.name:i.log("No title element found in sidebar item");let _=s.querySelector('[data-cart="cart-item-desc"]');if(_){let u=Object.keys(d.biomarkers).length;_.textContent=`${u} Biomarker`}else i.log("No desc element found in sidebar item");let N=s.querySelector('[data-cart="cart-item-price"]');if(N){let u=M?M.final:d.basePrice;N.textContent=y(u)}else i.log("No price element found in sidebar item");let D=s.querySelector('[data-cart="cart-item-price-unit"]');D&&(D.textContent="\u20AC");let b=s.querySelector('[data-cart="remove-item"]')||s.querySelector("button")||s.querySelector('[class*="remove"]');if(b){let u=b.cloneNode(!0);b.parentNode.replaceChild(u,b),u.addEventListener("click",g=>{g.preventDefault(),g.stopPropagation(),window.CartModal.remove(l.sku)})}})}a&&(a.textContent=y(n.total)),o&&(o.textContent="\u20AC"),q("[data-cart-count]").forEach(r=>{r.textContent=t.length}),i.log("Cart UI rendered:",{itemCount:t.length,total:n.total,deductions:n.deductions})}function F(){let e=document.querySelector('[data-cart="wrap"]'),t=document.querySelector('[data-cart="toggle"]');t&&e&&t.addEventListener("click",o=>{o.preventDefault();let r=e.getAttribute("data-modal-status")==="active";e.setAttribute("data-modal-status",r?"not-active":"active"),r||w()});let n=document.querySelector('[data-cart="close"]');n&&e&&n.addEventListener("click",o=>{o.preventDefault(),e.setAttribute("data-modal-status","not-active")});let a=document.querySelector('[data-cart="cart-empty"]');a&&a.addEventListener("click",o=>{o.preventDefault(),window.CartModal&&window.CartModal.clear(),p("Warenkorb wurde geleert","info")}),i.log("Cart controls setup complete")}function U(){document.addEventListener("click",e=>{var a;if(!((a=e.target)==null?void 0:a.closest('[data-cart="btn-buy"], #wf-checkout, [data-cart="checkout"]'))||(i.log("Checkout button clicked - redirecting to order page"),e.preventDefault(),e.stopPropagation(),!window.CartModal))return;if(window.CartModal.getItems().length===0){p("Warenkorb ist leer.","error");return}window.location.href="/deine-bestellung"},!0)}let E=0,z=50;function S(){if(E++,!window.CartModal){if(E<=z){E===1&&i.log("Waiting for CartModal..."),setTimeout(S,100);return}i.error("CartModal not available after 5s - initializing without it")}i.log("=== Biomarker package page initializing ==="),T(),window.CartModal&&w(),F(),U(),window.addEventListener("cart-updated",()=>{w()}),i.log("=== Biomarker package page initialized ===")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S()})();})();
